(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[42],{2369:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return m})),a.d(t,"d",(function(){return p}));var r=a(8),n=a.n(r),i=a(19),c=a(17);function s(e,t,a,r){return o.apply(this,arguments)}function o(){return(o=Object(i.a)(n.a.mark((function e(t,a,r,i){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,c.b.get("/archives?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return s=e.sent,e.abrupt("return",s.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(i.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.post("/archives",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return d.apply(this,arguments)}function d(){return(d=Object(i.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.put("/archives/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=Object(i.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.delete("/archives/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2450:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a(8),n=a.n(r),i=a(19),c=a(17);function s(e,t,a,r){return o.apply(this,arguments)}function o(){return(o=Object(i.a)(n.a.mark((function e(t,a,r,i){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,c.b.get("/typedocuments?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return s=e.sent,e.abrupt("return",s.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2451:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a(8),n=a.n(r),i=a(19),c=a(17);function s(e,t,a,r){return o.apply(this,arguments)}function o(){return(o=Object(i.a)(n.a.mark((function e(t,a,r,i){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,c.b.get("/agences?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return s=e.sent,e.abrupt("return",s.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3180:function(e,t,a){"use strict";a.r(t);var r=a(6),n=a(12),i=a(0),c=a.n(i),s=a(229),o=a.n(s),l=a(231),u=a(224),m=a(606),d=a(64),p=a(46),v=a(1201),h=a(79),b=a(228),g=a(144),f=a(783),y=a(2369),j=a(73),E=a(84),O=a(32),w=a(117),C=a(131),P=(a(368),a(369),a(367)),A=a(2450),S=a(2451),k=a(60),D=a(267);const x=h.b().shape({typedocument:h.c().required("Le champs Type de document est requis"),agence:h.c().required("Le champs Agence est requis"),compte:h.c().required("Le champs Compte client est requis"),anneedarchive:h.a().positive("L'ann\xe9e doit \xeatre un entier positif").integer("L'ann\xe9e doit \xeatre un entier positif").required("Le champs Ann\xe9e est requis"),moisdarchive:h.a().required("Le champs Mois est requis")});function L({id:e,learchive:t,handleFermeture:a,action:s}){var o,l;const u=Object(O.useQueryClient)(),v=Object(i.useState)(t),h=Object(n.a)(v,2),L=h[0],Q=(h[1],Object(D.a)().utilisateur),R=Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0}),M=Object(n.a)(R,2),q=M[0],B=M[1],F=Object(O.useMutation)(y.a,{onSuccess:()=>{u.invalidateQueries("Archives"),B({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{u.invalidateQueries("Archives"),B({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),N=Object(O.useMutation)(y.c,{onSuccess:()=>{u.invalidateQueries("Archives"),B({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{u.invalidateQueries("Archives"),B({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),T=Object(O.useQuery)(["Roles",1],()=>Object(A.a)(0,100,"",""),{keepPreviousData:!0}),z=T.isLoading,I=(T.isFetching,T.isError,T.error,T.data),J=Object(O.useQuery)(["Agences",1],()=>Object(S.a)(0,100,"",""),{keepPreviousData:!0}),_=Object(O.useMutation)(P.a,{onSuccess:e=>{B(Object(r.a)(Object(r.a)({},q),{},{automaticClose:!1,message:"Fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{B(Object(r.a)(Object(r.a)({},q),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),G=Object(j.c)({resolver:Object(b.yupResolver)(x)}),V=G.control,Y=G.handleSubmit,H=G.errors,K=(G.reset,e=>{let t=Object(r.a)(Object(r.a)(Object(r.a)({},L),e),{},{fichier:_.data,utilisateur:"/api/utilisateurs/"+Q.id});L?N.mutate(Object(r.a)({},t)):F.mutate(Object(r.a)({},t))});return c.a.createElement("div",null,c.a.createElement(E.a,{message:q.message,severity:q.severity,open:q.open,handleAlertClose:q.automaticClose?a:()=>B(Object(r.a)(Object(r.a)({},q),{},{open:!1}))}),c.a.createElement("form",{onSubmit:Y(K)},c.a.createElement(p.a,{container:!0,spacing:4,direction:"row",alignContent:"center",justify:"center"},c.a.createElement(p.a,{item:!0,sm:4},z?c.a.createElement(k.a,{message:"chargement"}):c.a.createElement(C.a,{id:"typedocument",name:"typedocument",label:"Choisir le type de document",table:"typedocument",control:V,options:I["hydra:member"],error:H.typedocument,valeur:null!==(o=null===L||void 0===L?void 0:L.typedocument)&&void 0!==o?o:""})),c.a.createElement(p.a,{item:!0,sm:4},J.isLoading?c.a.createElement(k.a,{message:"chargement"}):c.a.createElement(C.a,{id:"agence",name:"agence",label:"Choisir l'agence'",table:"agence",control:V,options:J.data["hydra:member"],error:H.agence,valeur:null!==(l=null===L||void 0===L?void 0:L.agence)&&void 0!==l?l:""}))),c.a.createElement(p.a,{container:!0,spacing:8,direction:"row",alignContent:"center",justify:"center"},c.a.createElement(p.a,{item:!0},c.a.createElement(w.a,{id:"anneedarchive",nom:"anneedarchive",label:"Ann\xe9e de l'archive",valeur:null===L||void 0===L?void 0:L.anneedarchive,control:V,error:H.anneedarchive})),c.a.createElement(p.a,{item:!0,item:!0,sm:4},c.a.createElement(w.a,{id:"moisdarchive",nom:"moisdarchive",label:"Mois de l'archive",valeur:null===L||void 0===L?void 0:L.moisdarchive,control:V,error:H.moisdarchive}))),c.a.createElement(p.a,{container:!0,spacing:4,direction:"row",alignContent:"center",justify:"center"},c.a.createElement(p.a,{item:!0,item:!0,sm:4},c.a.createElement(w.a,{id:"compte",nom:"compte",label:"Compte client",valeur:null===L||void 0===L?void 0:L.compte,control:V,error:H.compte}))),c.a.createElement(p.a,{container:!0,spacing:4,direction:"row",alignContent:"left"},c.a.createElement(p.a,{item:!0,item:!0,sm:4},c.a.createElement(p.a,{container:!0,alignItems:"center",justify:"space-between"},c.a.createElement(p.a,{item:!0,item:!0,sm:4},c.a.createElement(g.a,{color:"primary",variant:"contained",type:"submit",onClick:Y(K)},N.isLoading||F.isLoading?c.a.createElement(f.a,{color:"inherit"}):c.a.createElement(m.a,null,"checked"),c.a.createElement("span",{className:"pl-2 capitalize"},c.a.createElement(d.a,null,"Valider")))))))))}var Q=a(204),R=a(230),M=a(300),q=(a(443),a(1192));t.default=()=>{const e=Object(i.useState)({page:0,rowsPerPage:3,recherche:"",filtre:""}),t=Object(n.a)(e,2),a=t[0],s=t[1],h=Object(O.useQueryClient)(),b=Object(O.useQuery)(["Archives",a.page,a.rowsPerPage,a.recherche,a.filtre],()=>Object(y.b)(a.page,a.rowsPerPage,a.recherche,a.filtre),{keepPreviousData:!0}),g=b.isLoading,f=(b.isFetching,b.isError),j=b.error,w=b.data,C=Object(O.useMutation)(y.d,{onSuccess:()=>{J({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{J({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{h.invalidateQueries("Archives")}}),P=Object(i.useState)(null),A=Object(n.a)(P,2),S=A[0],D=A[1],x=Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),B=Object(n.a)(x,2),F=B[0],N=B[1],T=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>X()}),z=Object(n.a)(T,2),I=z[0],J=z[1],_=Object(i.useState)("Liste des archives"),G=Object(n.a)(_,2),V=G[0],Y=G[1],H=Object(i.useState)(!1),K=Object(n.a)(H,2),U=K[0],W=K[1],X=()=>{J(Object(r.a)(Object(r.a)({},E.a),{},{open:!1}))},Z=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"typedocument",label:"Type de document",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom}},{name:"agence",label:"Agence",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom}},{name:"utilisateur",label:"Cr\xe9\xe9\xe9 par",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom+" "+e.prenom}},{name:"compte",label:"Compte client",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"creele",label:"Cr\xe9\xe9e le",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>Object(q.a)(Date.parse(e),"dd/MM/yyyy")}},{name:"fichier",label:"Fichier",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"anneedarchive",label:"Ann\xe9e",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"moisdarchive",label:"Mois",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,t,a)=>c.a.createElement("div",null,c.a.createElement(u.a,{size:"small",onClick:()=>{(e=>{N({mode:"edition",action:"misajour",affichageTable:!1}),D(e),Y("Mise \xe0 jour du archive}")})({id:t.rowData[0],typedocument:t.rowData[1],agence:t.rowData[2],utilisateur:t.rowData[3],compte:t.rowData[4],creele:t.rowData[5],fichier:t.rowData[6],anneedarchive:t.rowData[7],moisdarchive:t.rowData[8]})}},c.a.createElement(m.a,{color:"primary"},"edit")),c.a.createElement(u.a,{size:"small",onClick:()=>(e=>{W(!0),D(e)})({id:t.rowData[0]})},c.a.createElement(m.a,{color:"error"},"delete")),c.a.createElement(u.a,{size:"small",onClick:()=>(t.rowData[0],void console.log("affichage de details"))},c.a.createElement(m.a,null,"arrow_right_alt")))}}];return c.a.createElement("div",{className:"m-sm-30"},c.a.createElement(E.a,{message:I.message,severity:I.severity,open:I.open,handleAlertClose:X}),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(Q.a,{routeSegments:[{name:"Gestion des archives"}]})),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(d.a,{variant:"h4"},V)),"affichage"===F.mode?c.a.createElement("div",{className:"m-sm-30"},c.a.createElement(p.a,{container:!0,spacing:4},c.a.createElement(p.a,{item:!0,lg:8,md:12,sm:12,xs:12},c.a.createElement(v.a,null,c.a.createElement(L,{action:F.action,learchive:S,handleFermeture:()=>{N({mode:"affichage",action:"nouveau",affichageTable:!0}),Y("Liste des archives")}})))),g?c.a.createElement(k.a,{message:"Chargement des donn\xe9es",type:"info"}):f?c.a.createElement(k.a,{message:"Erreur lors du chargement des donn\xe9es::"+j,type:"error"}):c.a.createElement(M.a,{tag:"div",blocking:!1},c.a.createElement(o.a,{title:V,data:w["hydra:member"],columns:Z,options:Object(r.a)(Object(r.a)({},l.a),{},{serverSide:!0,count:w["hydra:totalItems"],rowsPerPageOptions:[3,5,10],rowsPerPage:a.rowsPerPage,onChangePage:e=>(e=>{s(Object(r.a)(Object(r.a)({},a),{},{page:e})),h.invalidateQueries("Archives")})(e),onChangeRowsPerPage:e=>(e=>{s(Object(r.a)(Object(r.a)({},a),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),h.invalidateQueries("Archives")})(e),onSearchChange:e=>(e=>{var t;s(Object(r.a)(Object(r.a)({},a),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(t="texte a chercher"+e)&&void 0!==t?t:""),h.invalidateQueries("Archives")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})})),c.a.createElement(v.a,{className:"w-full overflow-auto",elevation:8},c.a.createElement(R.a,{open:U,onConfirmDialogClose:()=>{W(!1)},onYesClick:()=>{W(!1),C.mutate(S)},text:"Confirmez la suppression de "+(null===S||void 0===S?void 0:S.name)}))):c.a.createElement("div",null))}}}]);