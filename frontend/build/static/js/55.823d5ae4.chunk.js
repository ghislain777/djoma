(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[55],{2353:function(e,a,t){"use strict";t.d(a,"c",(function(){return i})),t.d(a,"a",(function(){return u})),t.d(a,"d",(function(){return m})),t.d(a,"e",(function(){return p})),t.d(a,"f",(function(){return h})),t.d(a,"b",(function(){return v}));var r=t(8),o=t.n(r),n=t(19),s=t(17);function i(e,a,t,r){return c.apply(this,arguments)}function c(){return(c=Object(n.a)(o.a.mark((function e(a,t,r,n){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a+=1,e.next=3,s.b.get("/chauffeurs?itemsPerPage="+t+"&page="+a+"&nom="+r);case 3:return i=e.sent,e.abrupt("return",i.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return l.apply(this,arguments)}function l(){return(l=Object(n.a)(o.a.mark((function e(a){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.post("/chauffeurs",a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return d.apply(this,arguments)}function d(){return(d=Object(n.a)(o.a.mark((function e(a){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.put("/chauffeurs/"+a.id,a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=Object(n.a)(o.a.mark((function e(a){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.delete("/chauffeurs/"+a.id,{method:"DELETE",herdears:{Accept:"application/json"},data:a.id});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=Object(n.a)(o.a.mark((function e(a){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.put("/chauffeurs/statut/togle/"+a.id);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=Object(n.a)(o.a.mark((function e(a){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.get("/chauffeurs/sansvehicule");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3175:function(e,a,t){"use strict";t.r(a);var r=t(6),o=t(12),n=t(0),s=t.n(n),i=t(229),c=t.n(i),u=t(231),l=t(2302),m=t(766),d=t(224),p=t(606),f=t(64),h=t(1241),b=t(144),v=t(1201),g=t(46),y=t(79),E=t(228),j=t(783),O=t(2353),C=t(73),w=t(84),q=t(32),P=t(117),S=t(131),D=(t(368),t(369)),x=t(367),k=t(833),N=t(60);const R=y.b().shape({quartier:y.c().required("Le Quartier est requis"),nom:y.c().required("Le champs Nom est requis"),prenom:y.c().required("Le champs Pr\xe9nom est requis"),adresse:y.c().required("Le champs Adresse est requis"),telephone:y.c().required("Le champs T\xe9l\xe9phone est requis"),numerocni:y.c().required("Le champs Num\xe9ro CNI est requis")});function B({id:e,lechauffeur:a,handleFermeture:t,action:i}){var c,u;const l=Object(q.useQueryClient)();const m=Object(q.useMutation)(O.a,{onSuccess:()=>{l.invalidateQueries("Chauffeurs"),U({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{l.invalidateQueries("Chauffeurs"),U({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),d=Object(q.useMutation)(O.d,{onSuccess:()=>{l.invalidateQueries("Chauffeurs"),U({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{l.invalidateQueries("Chauffeurs"),U({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),h=Object(q.useQuery)(["Quartiers",1],()=>Object(k.a)(0,100,"",""),{keepPreviousData:!0}),v=h.isLoading,y=(h.isFetching,h.isError,h.error,h.data),B=Object(q.useMutation)(x.a,{onSuccess:e=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),Q=Object(q.useMutation)(x.a,{onSuccess:e=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),L=Object(q.useMutation)(x.a,{onSuccess:e=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{U(Object(r.a)(Object(r.a)({},I),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),M=Object(n.useState)(a),A=Object(o.a)(M,2),T=A[0],F=(A[1],Object(n.useState)({severity:"severity",message:"",open:!1,automaticClose:!0})),z=Object(o.a)(F,2),I=z[0],U=z[1],J=Object(C.c)({resolver:Object(E.yupResolver)(R),defaultValues:Object(r.a)(Object(r.a)({},T),{},{actif:null!==(c=null===T||void 0===T?void 0:T.actif)&&void 0!==c&&c,quartier:a?"/api/quartiers/"+a.quartier.id:"/api/quartiers/1"})}),_=J.control,G=J.handleSubmit,V=J.errors,Y=(J.reset,e=>{let a=Object(r.a)(Object(r.a)(Object(r.a)({},T),e),{},{photo:B.data,photopermi:L.data,photocni:Q.data});T?d.mutate(Object(r.a)({},a)):m.mutate(Object(r.a)({},a))});return s.a.createElement("div",null,s.a.createElement(w.a,{message:I.message,severity:I.severity,open:I.open,handleAlertClose:I.automaticClose?t:()=>U(Object(r.a)(Object(r.a)({},I),{},{open:!1}))}),s.a.createElement("form",{onSubmit:G(Y)},s.a.createElement(g.a,{container:!0,spacing:4,direction:"column"},s.a.createElement(g.a,{item:!0},s.a.createElement(D.a,{onUpload:e=>{var a;(a=e)&&B.mutate({fichier:a,objet:"photochauffeur"})},onSupprimer:()=>{console.log("suppression du fichier"+T.photo)},titre:"Photos du chauffeur (faire glisser ou cliquez ici pour charger)"})),s.a.createElement(g.a,{item:!0},s.a.createElement(D.a,{onUpload:e=>{var a;(a=e)&&Q.mutate({fichier:a,objet:"cnichauffeur"})},onSupprimer:()=>{console.log("suppression du fichier"+T.photo)},titre:"CNI du chauffeur (faire glisser ou cliquez ici pour charger)"})),s.a.createElement(g.a,{item:!0},s.a.createElement(D.a,{onUpload:e=>{var a;(a=e)&&L.mutate({fichier:a,objet:"permischauffeur"})},onSupprimer:()=>{console.log("suppression du fichier"+T.photo)},titre:"Permis de conduire du chauffeur (faire glisser ou cliquez ici pour charger)"})),s.a.createElement(g.a,{item:!0},v?s.a.createElement(N.a,{message:"chargement des quartiers..."}):s.a.createElement(S.a,{id:"quartier",name:"quartier",label:"Choisir un quartier",table:"quartier",control:_,options:y["hydra:member"],error:V.quartier,valeur:null!==(u=null===T||void 0===T?void 0:T.quartier)&&void 0!==u?u:""})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"nom",nom:"nom",label:"Nom",valeur:null===T||void 0===T?void 0:T.nom,control:_,error:V.nom})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"prenom",nom:"prenom",label:"Pr\xe9nom",valeur:null===T||void 0===T?void 0:T.prenom,control:_,error:V.prenom})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"adresse",nom:"adresse",label:"Adresse",valeur:null===T||void 0===T?void 0:T.adresse,control:_,error:V.adresse})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"telephone",nom:"telephone",label:"T\xe9l\xe9phone",valeur:null===T||void 0===T?void 0:T.telephone,control:_,error:V.telephone})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"numerocni",nom:"numerocni",label:"Num\xe9ro CNI",valeur:null===T||void 0===T?void 0:T.numerocni,control:_,error:V.numerocni})),s.a.createElement(g.a,{item:!0},s.a.createElement(P.a,{id:"numeropermis",nom:"numeropermis",label:"Num\xe9ro de permis",valeur:null===T||void 0===T?void 0:T.numeropermis,control:_,error:V.numeropermis})),s.a.createElement(g.a,{item:!0},s.a.createElement(g.a,{container:!0,alignItems:"center",justify:"space-between"},s.a.createElement(g.a,{item:!0},s.a.createElement(b.a,{color:"primary",variant:"contained",type:"submit",onClick:G(Y)},d.isLoading||m.isLoading?s.a.createElement(j.a,{color:"inherit"}):s.a.createElement(p.a,null,"send"),s.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===i?s.a.createElement(f.a,null,"Enregistrer"):s.a.createElement(f.a,null,"Mettre \xe0 jour")))),s.a.createElement(g.a,{item:!0},s.a.createElement(b.a,{variant:"outlined",color:"secondary",onClick:function(){t()}},"Annuler")))))))}var Q=t(204),L=t(230),M=t(300),A=(t(443),t(1192)),T=t(17);a.default=()=>{const e=Object(n.useState)({page:0,rowsPerPage:20,recherche:"",filtre:""}),a=Object(o.a)(e,2),t=a[0],i=a[1],y=Object(q.useQueryClient)(),E=Object(q.useQuery)(["Chauffeurs",t.page,t.rowsPerPage,t.recherche,t.filtre],()=>Object(O.c)(t.page,t.rowsPerPage,t.recherche,t.filtre),{keepPreviousData:!0}),j=E.isLoading,C=(E.isFetching,E.isError),P=E.error,S=E.data,D=Object(q.useMutation)(O.f,{onSuccess:()=>{H({message:"op\xe9ration r\xe9ussie r\xe9ussi",open:!0,severity:"success"})},onError:()=>{H({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{y.invalidateQueries("Chauffeurs")}}),x=Object(q.useMutation)(O.e,{onSuccess:()=>{H({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{H({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{y.invalidateQueries("Chauffeurs")}}),k=Object(n.useState)(null),R=Object(o.a)(k,2),F=R[0],z=R[1],I=Object(n.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),U=Object(o.a)(I,2),J=U[0],_=U[1],G=Object(n.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>re()}),V=Object(o.a)(G,2),Y=V[0],H=V[1],K=Object(n.useState)("Liste des chauffeurs"),W=Object(o.a)(K,2),X=W[0],Z=W[1],$=Object(n.useState)(!1),ee=Object(o.a)($,2),ae=ee[0],te=ee[1],re=()=>{H(Object(r.a)(Object(r.a)({},w.a),{},{open:!1}))},oe=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"quartier",label:"Quartier",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e.nom+" / "+e.commune.nom}},{name:"nom",label:"Nom",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"prenom",label:"Pr\xe9nom",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"adresse",label:"Adresse",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"telephone",label:"T\xe9l\xe9phone",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"numerocni",label:"Num\xe9ro CNI",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"photo",label:"Photo",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(l.a,{variant:"rounded",src:T.f+"/fichiers/photoschauffeurs/"+e})}},{name:"photocni",label:"Photo cni",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(l.a,{variant:"rounded",src:T.f+"/fichiers/cnischauffeurs/"+e})}},{name:"numeropermis",label:"Num\xe9ro de permis",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"photopermi",label:"Photo permis",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(l.a,{variant:"rounded",src:T.f+"/fichiers/permischauffeurs/"+e})}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"lat",label:"Latitude",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"lon",label:"Longitude",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"creele",label:"Cr\xe9\xe9 le",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>Object(A.a)(Date.parse(e),"dd/MM/yyyy")}},{name:"actif",label:"Actif",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(m.a,{checked:e,onChange:()=>{return e={id:a.rowData[0]},void D.mutate(e);var e}})}},{name:"token",label:"",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"validitetoken",label:"",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,a,t)=>s.a.createElement("div",null,s.a.createElement(d.a,{size:"small",onClick:()=>{(e=>{_({mode:"edition",action:"misajour",affichageTable:!1}),z(e),Z("Mise \xe0 jour de chauffeur")})({id:a.rowData[0],quartier:a.rowData[1],nom:a.rowData[2],prenom:a.rowData[3],adresse:a.rowData[4],telephone:a.rowData[5],numerocni:a.rowData[6],photo:a.rowData[7],photocni:a.rowData[8],numeropermis:a.rowData[9],photopermi:a.rowData[10],statut:a.rowData[11],lat:a.rowData[12],lon:a.rowData[13],creele:a.rowData[14],actif:a.rowData[15],token:a.rowData[16],validitetoken:a.rowData[17]})}},s.a.createElement(p.a,{color:"primary"},"edit")),s.a.createElement(d.a,{size:"small",onClick:()=>(a.rowData[0],void console.log("affichage de details"))},s.a.createElement(p.a,null,"arrow_right_alt")))}}];return s.a.createElement("div",{className:"m-sm-30"},s.a.createElement(w.a,{message:Y.message,severity:Y.severity,open:Y.open,handleAlertClose:re}),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(Q.a,{routeSegments:[{name:"Gestion des chauffeurs"}]})),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(f.a,{variant:"h4"},X)),"affichage"===J.mode?s.a.createElement(h.a,{in:J.affichageTable,direction:"right",unmountOnExit:!0},s.a.createElement("div",null,s.a.createElement(b.a,{className:"mb-4",variant:"contained",color:"primary",onClick:()=>(_({mode:"edition",action:"ajout",affichageTable:!1}),z(null),void Z("Nouveau chauffeur"))},"Nouveau chauffeur"),j?s.a.createElement(N.a,{message:"Chargement des donn\xe9es",type:"info"}):C?s.a.createElement(N.a,{message:"Erreur lors du chargement des donn\xe9es::"+P,type:"error"}):s.a.createElement(M.a,{tag:"div",blocking:!1},s.a.createElement(c.a,{title:X,data:S["hydra:member"],columns:oe,options:Object(r.a)(Object(r.a)({},u.a),{},{serverSide:!0,count:S["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:t.rowsPerPage,onChangePage:e=>(e=>{i(Object(r.a)(Object(r.a)({},t),{},{page:e})),y.invalidateQueries("Chauffeurs")})(e),onChangeRowsPerPage:e=>(e=>{i(Object(r.a)(Object(r.a)({},t),{},{rowsPerPage:e})),console.log("nombre de ligne par page:"+e),y.invalidateQueries("Chauffeurs")})(e),onSearchChange:e=>(e=>{var a;i(Object(r.a)(Object(r.a)({},t),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(a="texte a chercher"+e)&&void 0!==a?a:""),y.invalidateQueries("Chauffeurs")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})})),s.a.createElement(v.a,{className:"w-full overflow-auto",elevation:8},s.a.createElement(L.a,{open:ae,onConfirmDialogClose:()=>{te(!1)},onYesClick:()=>{te(!1),x.mutate(F)},text:"Confirmez la suppression de "+(null===F||void 0===F?void 0:F.name)})))):s.a.createElement(g.a,{container:!0,spacing:6,alignContent:"center",justify:"center"},s.a.createElement(g.a,{item:!0,lg:6,md:6,sm:12,xs:12},s.a.createElement(v.a,{className:"px-6 pt-2 pb-4"},s.a.createElement(B,{action:J.action,lechauffeur:F,handleFermeture:()=>{_({mode:"affichage",action:"nouveau",affichageTable:!0}),Z("Liste des chauffeurs")}})))))}}}]);