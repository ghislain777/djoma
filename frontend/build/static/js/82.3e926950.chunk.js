(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[82],{3143:function(e,t,a){"use strict";a.r(t);var r=a(6),n=a(12),i=a(0),s=a.n(i),c=a(229),o=a.n(c),l=a(231),u=a(766),m=a(64),p=a(46),d=a(1201),v=a(262),g=a(434),b=a(568),h=a(1241),f=a(79),E=a(228),j=a(144),y=a(783),O=a(606),P=a(8),w=a.n(P),C=a(19),x=a(17);function S(){return(S=Object(C.a)(w.a.mark((function e(t,a,r,n,i){var s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,x.b.get("/privileges?itemsPerPage="+a+"&page="+t+"&id="+r+"&role="+i);case 3:return s=e.sent,e.abrupt("return",s.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(C.a)(w.a.mark((function e(t){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.b.post("/privileges",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return L.apply(this,arguments)}function L(){return(L=Object(C.a)(w.a.mark((function e(t){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.b.put("/privileges/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return D.apply(this,arguments)}function D(){return(D=Object(C.a)(w.a.mark((function e(t){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.b.put("/privileges/togle/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return B.apply(this,arguments)}function B(){return(B=Object(C.a)(w.a.mark((function e(t){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.b.delete("/privileges/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=a(73),M=a(84),F=a(32),T=a(117),I=(a(131),a(368)),z=(a(369),a(367),a(60));const J=f.b().shape({activite:f.c().required("Le champs Activit\ufffd est requis"),role:f.c().required("Le champs Role est requis"),actif:f.c().required("Le champs Actif? est requis"),description:f.c().required("Le champs Description est requis")});function G({id:e,leprivilege:t,handleFermeture:a,action:c}){var o;const l=Object(F.useQueryClient)(),u=Object(F.useMutation)(k,{onSuccess:()=>{l.invalidateQueries("Privileges"),C({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{l.invalidateQueries("Privileges"),C({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),d=Object(F.useMutation)(R,{onSuccess:()=>{l.invalidateQueries("Privileges"),C({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{l.invalidateQueries("Privileges"),C({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),v=Object(i.useState)(t),g=Object(n.a)(v,2),b=g[0],h=g[1],f=Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0}),P=Object(n.a)(f,2),w=P[0],C=P[1],x=Object(N.c)({resolver:Object(E.yupResolver)(J)}),S=x.control,Q=x.handleSubmit,L=x.errors,A=(x.reset,e=>{let t=Object(r.a)(Object(r.a)({},b),e);b?d.mutate(Object(r.a)({},t)):u.mutate(Object(r.a)({},t))});return s.a.createElement("div",null,s.a.createElement(M.a,{message:w.message,severity:w.severity,open:w.open,handleAlertClose:w.automaticClose?a:()=>C(Object(r.a)(Object(r.a)({},w),{},{open:!1}))}),s.a.createElement("form",{onSubmit:Q(A)},s.a.createElement(p.a,{container:!0,spacing:4,direction:"column"},s.a.createElement(p.a,{item:!0},s.a.createElement(T.a,{id:"activite",nom:"activite",label:"Activit\ufffd",valeur:null===b||void 0===b?void 0:b.activite,control:S,error:L.activite})),s.a.createElement(p.a,{item:!0},s.a.createElement(T.a,{id:"role",nom:"role",label:"Role",valeur:null===b||void 0===b?void 0:b.role,control:S,error:L.role})),s.a.createElement(p.a,null,s.a.createElement(I.a,{id:"actif",nom:"actif",control:S,coche:Boolean(null!==(o=null===b||void 0===b?void 0:b.actif)&&void 0!==o?o:""),onChange:e=>{h(Object(r.a)(Object(r.a)({},b),{},{actif:e}))}})),s.a.createElement(p.a,{item:!0},s.a.createElement(T.a,{id:"description",nom:"description",label:"Description",valeur:null===b||void 0===b?void 0:b.description,control:S,error:L.description})),s.a.createElement(p.a,{item:!0},s.a.createElement(p.a,{container:!0,alignItems:"center",justify:"space-between"},s.a.createElement(p.a,{item:!0},s.a.createElement(j.a,{color:"primary",variant:"contained",type:"submit",onClick:Q(A)},d.isLoading||u.isLoading?s.a.createElement(y.a,{color:"inherit"}):s.a.createElement(O.a,null,"send"),s.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===c?s.a.createElement(m.a,null,"Enregistrer"):s.a.createElement(m.a,null,"Mettre \xe0 jour")))),s.a.createElement(p.a,{item:!0},s.a.createElement(j.a,{variant:"outlined",color:"secondary",onClick:function(){a()}},"Annuler")))))))}var Y=a(204),H=a(230),K=a(300);a(443);function U(){return(U=Object(C.a)(w.a.mark((function e(t,a,r,n){var i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,x.b.get("/roles?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return i=e.sent,e.abrupt("return",i.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default=()=>{const e=Object(i.useState)({page:0,rowsPerPage:30,recherche:"",filtre:"",role:""}),t=Object(n.a)(e,2),a=t[0],c=t[1],f=Object(F.useQueryClient)(),E=Object(F.useQuery)(["Privileges",a.page,a.rowsPerPage,a.recherche,a.filtre,a.role],()=>function(e,t,a,r,n){return S.apply(this,arguments)}(a.page,a.rowsPerPage,a.recherche,a.filtre,a.role),{keepPreviousData:!0}),j=E.isLoading,y=(E.isFetching,E.isError),O=E.error,P=E.data,w=Object(F.useMutation)(q,{onSuccess:()=>{V({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{V({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{f.invalidateQueries("Privileges")}}),C=Object(F.useMutation)(A,{onSuccess:()=>{V({message:"op\xe9ration r\xe9ussie r\xe9ussi",open:!0,severity:"success"})},onError:()=>{V({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{f.invalidateQueries("Privileges")}}),x=Object(F.useQuery)(["Roles",1],()=>function(e,t,a,r){return U.apply(this,arguments)}(0,100,"",""),{keepPreviousData:!0}),k=Object(i.useState)(null),Q=Object(n.a)(k,2),R=Q[0],L=(Q[1],Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0})),D=Object(n.a)(L,2),B=D[0],N=D[1],T=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>re()}),I=Object(n.a)(T,2),J=I[0],V=I[1],W=Object(i.useState)("Liste des privileges"),X=Object(n.a)(W,2),Z=X[0],$=X[1],_=Object(i.useState)(!1),ee=Object(n.a)(_,2),te=ee[0],ae=ee[1],re=()=>{V(Object(r.a)(Object(r.a)({},M.a),{},{open:!1}))},ne=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>e}},{name:"activite",label:"Menu",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>s.a.createElement("strong",null,e.menu.nom)}},{name:"activite",label:"Activit\xe9",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom}},{name:"activite",label:"description",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.description}},{name:"role",label:"Role",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom}},{name:"actif",label:"Actif?",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>s.a.createElement(u.a,{checked:e,onChange:()=>(e=>{C.mutate(e)})({id:t.rowData[0]})})}},{name:"description",label:"Description",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>e}}];return s.a.createElement("div",{className:"m-sm-30"},s.a.createElement(M.a,{message:J.message,severity:J.severity,open:J.open,handleAlertClose:re}),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(Y.a,{routeSegments:[{name:"Gestion des privileges"}]})),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(m.a,{variant:"h4"},Z)),s.a.createElement(p.a,{container:!0,spacing:3,className:" pt-2 pb-4"},s.a.createElement(p.a,{item:!0,lg:6,md:6,sm:12,xs:12},s.a.createElement(d.a,{className:"px-6 pt-2 pb-4"},s.a.createElement(p.a,{container:!0,spacing:4,direction:"row"},s.a.createElement(p.a,{item:!0},s.a.createElement(m.a,{variant:"h6"},"Filtrer par r\xf4le")),s.a.createElement(p.a,{item:!0},x.isLoading?s.a.createElement(z.a,{message:"chargement des roles"}):s.a.createElement(v.a,null,s.a.createElement(g.a,{variant:"outlined",displayEmpty:!0,id:"role",value:a.role,onChange:e=>{c(Object(r.a)(Object(r.a)({},a),{},{role:e.target.value})),f.invalidateQueries("Privileges")}},s.a.createElement(b.a,{value:""},"Choisir un role pour filtrer"),x.data["hydra:member"].map(e=>s.a.createElement(b.a,{key:e.id,value:e.id},e.nom))))))))),"affichage"===B.mode?s.a.createElement(h.a,{in:B.affichageTable,direction:"right",unmountOnExit:!0},s.a.createElement("div",null,j?s.a.createElement(z.a,{message:"Chargement des donn\xe9es",type:"info"}):y?s.a.createElement(z.a,{message:"Erreur lors du chargement des donn\xe9es::"+O,type:"error"}):s.a.createElement(K.a,{tag:"div",blocking:!1},s.a.createElement(o.a,{title:Z,data:P["hydra:member"],columns:ne,options:Object(r.a)(Object(r.a)({},l.a),{},{serverSide:!0,count:P["hydra:totalItems"],rowsPerPageOptions:[30,40,60],rowsPerPage:a.rowsPerPage,onChangePage:e=>(e=>{c(Object(r.a)(Object(r.a)({},a),{},{page:e})),f.invalidateQueries("Privileges")})(e),onChangeRowsPerPage:e=>(e=>{c(Object(r.a)(Object(r.a)({},a),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),f.invalidateQueries("Privileges")})(e),onSearchChange:e=>(e=>{var t;c(Object(r.a)(Object(r.a)({},a),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(t="texte a chercher"+e)&&void 0!==t?t:""),f.invalidateQueries("Privileges")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})})),s.a.createElement(d.a,{className:"w-full overflow-auto",elevation:8},s.a.createElement(H.a,{open:te,onConfirmDialogClose:()=>{ae(!1)},onYesClick:()=>{ae(!1),w.mutate(R)},text:"Confirmez la suppression de "+(null===R||void 0===R?void 0:R.name)})))):s.a.createElement(p.a,{container:!0,spacing:6,alignContent:"center",justify:"center"},s.a.createElement(p.a,{item:!0,lg:6,md:6,sm:12,xs:12},s.a.createElement(d.a,{className:"px-6 pt-2 pb-4"},s.a.createElement(G,{action:B.action,leprivilege:R,handleFermeture:()=>{N({mode:"affichage",action:"nouveau",affichageTable:!0}),$("Liste des privileges")}})))))}}}]);