(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[97],{3091:function(e,a,t){"use strict";t.r(a);var l=t(6),n=t(12),r=t(26),o=t(0),s=t.n(o),i=t(229),c=t.n(i),m=t(231),d=t(2302),u=t(752),p=t(144),b=t(766),E=t(2201),g=t(568),h=t(2241),v=t(606),f=t(1198),y=t(64),j=t(1241),w=t(1201),O=t(95),C=t(1151),x=t(84),D=t(204),N=t(230),P=t(32),R=t(60),S=t(2286),B=t(300),k=(t(443),t(1192)),M=t(2285),I=t(17),A=t(3),L=t(110),Q=t(1196),F=t(2267),T=t(2191),z=t(232);const W=Object(L.a)(e=>{e.palette,Object(r.a)(e,["palette"]);return{userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185},userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185}}});a.default=()=>{const e=W(),a=Object(o.useState)({page:0,rowsPerPage:20,recherche:"",filtre:""}),t=Object(n.a)(a,2),r=t[0],i=t[1],L=Object(P.useQueryClient)(),q=Object(P.useQuery)(["Clients",r.page,r.rowsPerPage,r.recherche,r.filtre],()=>Object(z.d)(r.page,r.rowsPerPage,r.recherche,r.filtre),{keepPreviousData:!0}),G=q.isLoading,J=(q.isFetching,q.isError),V=q.error,Y=q.data,H=Object(P.useMutation)(z.f,{onSuccess:()=>{re({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{re({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{L.invalidateQueries("Clients")}}),K=Object(o.useState)(null),U=Object(n.a)(K,2),X=U[0],Z=U[1],$=Object(o.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),_=Object(n.a)($,2),ee=_[0],ae=_[1],te=Object(o.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>be()}),le=Object(n.a)(te,2),ne=le[0],re=le[1],oe=Object(o.useState)("Liste des clients"),se=Object(n.a)(oe,2),ie=se[0],ce=se[1],me=Object(o.useState)(!1),de=Object(n.a)(me,2),ue=de[0],pe=de[1],be=()=>{re(Object(l.a)(Object(l.a)({},x.a),{},{open:!1}))},Ee=Object(P.useMutation)(z.b,{onSuccess:()=>{re({message:"op\xe9ration r\xe9ussie",open:!0,severity:"success"})},onError:()=>{re({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{L.invalidateQueries("Clients")}}),ge=Object(P.useMutation)(z.g,{onSuccess:()=>{re({message:"op\xe9ration r\xe9ussie",open:!0,severity:"success"})},onError:()=>{re({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{L.invalidateQueries("Clients")}}),he=Object(o.useState)({open:!1,fichier:"",titre:""}),ve=Object(n.a)(he,2),fe=ve[0],ye=ve[1],je=e=>{Ee.mutate({id:e.id,statut:e.statut})},we=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e.toLocaleString("fr-FR")}},{name:"quartier",label:"Village",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(s.a.Fragment,null,e.nom,s.a.createElement("br",null),s.a.createElement("small",{className:"text-muted"},e.commune.nom))}},{name:"civilite",label:"Civilit\xe9",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"nom",label:"Nom",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>{var l;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"flex items-center"},s.a.createElement(d.a,{variant:"rounded",className:"w-48 h-48",src:I.f+"/fichiers/photoclient/"+a.rowData[8]}),s.a.createElement("div",{className:"ml-3"},s.a.createElement("h5",{className:"my-0 text-15"},("MALE"===a.rowData[2]?"M. ":"Mme. ")+e+" "+(null!==(l=a.rowData[4])&&void 0!==l?l:"")),s.a.createElement("small",{className:"text-muted"},a.rowData[5]),s.a.createElement("br",null),s.a.createElement("small",{className:"text-muted"},a.rowData[6]))))}}},{name:"prenom",label:"Pr\xe9nom",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"telephone",label:"T\xe9l\xe9phone",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"email",label:"Email",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"motdepasse",label:"Mot de passe",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>e}},{name:"photo",label:"Photo",options:{filter:!1,sort:!1,display:"excluded",customBodyRender:(e,a,t)=>s.a.createElement(u.a,{onClick:()=>{ye({open:!0,fichier:e,titre:"photo"})}},s.a.createElement(p.a,null,s.a.createElement(d.a,{variant:"rounded",className:"w-48 h-48",src:I.f+"/fichiers/photoclient/"+e})))}},{name:"adresse",label:"Adresse",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,a,t)=>e}},{name:"actif",label:"Actif?",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>s.a.createElement(b.a,{checked:e,onChange:()=>(e=>{ge.mutate(e)})({id:a.rowData[0],actif:e})})}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(a,t,l)=>s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement(O.p,{menuButton:s.a.createElement("div",{className:e.userMenu},s.a.createElement(E.a,{xsDown:!0},s.a.createElement(p.a,{size:"small",variant:"text",color:"primary",endIcon:s.a.createElement(S.a,null)},s.a.createElement("small",{className:Object(A.default)({"border-radius-4  text-white px-2 py-2px":!0,"bg-primary":"Prospect"===a,"bg-secondary":"Contact"===a,"bg-error":"Annul\xe9e"===a,"bg-green":"Client"===a})},a))))},s.a.createElement(g.a,{onClick:()=>je({id:t.rowData[0],statut:"Client"})},s.a.createElement("span",null,"Client")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>je({id:t.rowData[0],statut:"Prospect"})},s.a.createElement("span",null,"Prospect")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>je({id:t.rowData[0],statut:"Contact"})},s.a.createElement("span",null,"Contact")))))}},{name:"creele",label:"Cr\xe9\xe9 le",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>null==e?" ":Object(k.a)(Object(M.a)(e),"dd/MM/yyyy hh:mm")}},{name:"utilisateur",label:"Gestionnaire",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>{var l,n;return(null!==(l=null===e||void 0===e?void 0:e.nom)&&void 0!==l?l:" ")+" "+(null!==(n=null===e||void 0===e?void 0:e.prenom)&&void 0!==n?n:" ")}}},{name:"soustraitant",label:"Sous traitant",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>{var l,n;return s.a.createElement(s.a.Fragment,null,null!==(l=null===e||void 0===e?void 0:e.nom)&&void 0!==l?l:" ",s.a.createElement("br",null),s.a.createElement("small",{className:"text-muted"},null!==(n=null===e||void 0===e?void 0:e.telephone)&&void 0!==n?n:""))}}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(a,t,l)=>s.a.createElement("div",null,s.a.createElement(O.p,{menuButton:s.a.createElement("div",{className:e.userMenu},s.a.createElement(E.a,{xsDown:!0},s.a.createElement(p.a,{size:"small",variant:"outlined",color:"primary",endIcon:s.a.createElement(S.a,null)},"Actions")))},s.a.createElement(g.a,{onClick:()=>(e=>{ae({mode:"edition",action:"misajour",affichageTable:!1}),Z(e),ce("Mise \xe0 jour de client")})({id:t.rowData[0],quartier:t.rowData[1],civilite:t.rowData[2],nom:t.rowData[3],prenom:t.rowData[4],telephone:t.rowData[5],email:t.rowData[6],motdepasse:t.rowData[7],photo:t.rowData[8],adresse:t.rowData[9],actif:t.rowData[10],statut:t.rowData[11],creele:t.rowData[12],utilisateur:t.rowData[13],soustraitant:t.rowData[14]})},s.a.createElement("span",null,s.a.createElement(v.a,{color:"primary"},"edit"),"Editer le client")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>De({id:t.rowData[0]})},s.a.createElement("span",null,"Contrats du client")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>xe({id:t.rowData[0]})},s.a.createElement("span",null,"Nouveau contrat")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>Ce({id:t.rowData[0]})},s.a.createElement("span",null,"R\xe9clamantions")),s.a.createElement(h.a,null),s.a.createElement(g.a,{onClick:()=>Oe({id:t.rowData[0]})},s.a.createElement("span",null,"Nouvelle r\xe9clamation  "))))}}],Oe=()=>{console.log("le filtre a chang\xe9")},Ce=()=>{console.log("le filtre a chang\xe9")},xe=()=>{console.log("le filtre a chang\xe9")},De=()=>{console.log("le filtre a chang\xe9")};return s.a.createElement("div",{className:"m-sm-30"},s.a.createElement(f.a,{open:fe.open,"aria-labelledby":"",maxWidth:"md",onClose:()=>{ye(Object(l.a)(Object(l.a)({},fe),{},{open:!1}))}},s.a.createElement(F.a,{id:""},fe.titre),s.a.createElement(T.a,null,s.a.createElement("img",{src:I.f+"/fichiers/photoclient/"+fe.fichier,alt:"photos",srcset:""}))),s.a.createElement(x.a,{message:ne.message,severity:ne.severity,open:ne.open,handleAlertClose:be}),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(D.a,{routeSegments:[{name:"Gestion des clients"}]})),s.a.createElement("div",{className:"mb-sm-30"},s.a.createElement(y.a,{variant:"h4"},ie)),"affichage"===ee.mode?s.a.createElement(j.a,{in:ee.affichageTable,direction:"right",unmountOnExit:!0},s.a.createElement("div",null,s.a.createElement(p.a,{className:"mb-4",variant:"contained",color:"primary",onClick:()=>(ae({mode:"edition",action:"ajout",affichageTable:!1}),Z(null),void ce("Nouveau client"))},"Nouveau client"),G?s.a.createElement(R.a,{message:"Chargement des donn\xe9es",type:"info"}):J?s.a.createElement(R.a,{message:"Erreur lors du chargement des donn\xe9es::"+V,type:"error"}):s.a.createElement(B.a,{tag:"div",blocking:!1},s.a.createElement(Q.a,{theme:Object(I.a)()},s.a.createElement(c.a,{title:ie,data:Y["hydra:member"],columns:we,options:Object(l.a)(Object(l.a)({},m.a),{},{serverSide:!0,count:Y["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:r.rowsPerPage,textLabels:Object(l.a)(Object(l.a)({},m.a.textLabels),{},{toolbar:Object(l.a)(Object(l.a)({},m.a.textLabels.toolbar),{},{search:"Rechercher par Nom"})}),onChangePage:e=>(e=>{i(Object(l.a)(Object(l.a)({},r),{},{page:e})),L.invalidateQueries("Clients")})(e),onChangeRowsPerPage:e=>(e=>{i(Object(l.a)(Object(l.a)({},r),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),L.invalidateQueries("Clients")})(e),onSearchChange:e=>(e=>{var a;i(Object(l.a)(Object(l.a)({},r),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(a="texte a chercher"+e)&&void 0!==a?a:""),L.invalidateQueries("Clients")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})}))),s.a.createElement(w.a,{className:"w-full overflow-auto",elevation:8},s.a.createElement(N.a,{open:ue,onConfirmDialogClose:()=>{pe(!1)},onYesClick:()=>{pe(!1),H.mutate(X)},text:"Confirmez la suppression de "+(null===X||void 0===X?void 0:X.name)})))):s.a.createElement(C.a,{action:ee.action,leclient:X,handleFermeture:()=>{ae({mode:"affichage",action:"nouveau",affichageTable:!0}),ce("Liste des clients")}}))}}}]);