(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[98],{3161:function(e,t,a){"use strict";a.r(t);var r=a(6),n=a(12),o=a(26),i=a(0),l=a.n(i),c=a(229),s=a.n(c),m=a(231),u=a(2302),d=a(752),p=a(144),b=a(224),g=a(606),v=a(568),E=a(1198),h=a(64),j=a(1241),O=a(1201),f=a(46),y=(a(95),a(79)),C=a(228),w=a(1204),S=a(1203),N=a(1202),x=a(783),D=a(835),P=a(73),k=a(84),M=a(32),L=a(117),R=a(131),Q=(a(368),a(369)),A=a(60),B=(a(265),a(444),a(17)),I=a(1196),q=a(367),F=a(232),T=a(8),z=a.n(T),U=a(19);function W(){return(W=Object(U.a)(z.a.mark((function e(t,a,r,n){var o;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,B.b.get("/produits?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}const J=y.b().shape({client:y.c().required("Le champs client est requis"),produit:y.c().required("Le champs produit est requis"),numero:y.c().required("Le champs Num\xe9ro du kit est requis")});function G({id:e,lecontrat:t,handleFermeture:a,action:o}){var c,s,m,u,d;const v=Object(M.useQueryClient)(),E=Object(M.useMutation)(D.a,{onSuccess:()=>{v.invalidateQueries("Contrats"),H({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{v.invalidateQueries("Contrats"),H({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),j=Object(M.useMutation)(D.c,{onSuccess:()=>{v.invalidateQueries("Contrats"),H({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{v.invalidateQueries("Contrats"),H({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),y=Object(M.useQuery)(["Clients",1],()=>Object(F.d)(0,1e4,"",""),{keepPreviousData:!0}),T=Object(M.useQuery)(["Produits",1],()=>function(e,t,a,r){return W.apply(this,arguments)}(0,100,"",""),{keepPreviousData:!0}),z=Object(i.useState)(t),U=Object(n.a)(z,2),G=U[0],K=(U[1],Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0})),V=Object(n.a)(K,2),Y=V[0],H=V[1],X=Object(P.c)({resolver:Object(C.yupResolver)(J),defaultValues:Object(r.a)(Object(r.a)({},t),{},{id:null!==(c=null===t||void 0===t?void 0:t.id)&&void 0!==c?c:"",client:t?"/api/clients/"+t.client.id:"/api/clients/1",produit:t?"/api/produits/"+t.produit.id:"/api/produits/1",numero:null!==(s=null===t||void 0===t?void 0:t.numero)&&void 0!==s?s:"",datededebut:null!==(m=null===t||void 0===t?void 0:t.datededebut)&&void 0!==m?m:new Date})}),Z=X.control,$=X.handleSubmit,_=X.errors,ee=(X.reset,Object(i.useState)(0)),te=Object(n.a)(ee,2),ae=te[0],re=te[1],ne=e=>{var t=Math.round(100*e.loaded/e.total);re(t)},oe=Object(M.useMutation)(q.a,{onSuccess:e=>{se(Object(r.a)(Object(r.a)({},ce),{},{document:e})),H(Object(r.a)(Object(r.a)({},Y),{},{automaticClose:!1,message:"Fichier document charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{H(Object(r.a)(Object(r.a)({},Y),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),ie=Object(i.useState)({}),le=Object(n.a)(ie,2),ce=le[0],se=le[1],me=e=>{let t=Object(r.a)(Object(r.a)(Object(r.a)({},G),e),ce);G?j.mutate(Object(r.a)({},t)):E.mutate(Object(r.a)({},t))};function ue(){a()}return l.a.createElement("div",null,l.a.createElement(k.a,{message:Y.message,severity:Y.severity,open:Y.open,handleAlertClose:Y.automaticClose?a:()=>H(Object(r.a)(Object(r.a)({},Y),{},{open:!1}))}),l.a.createElement(f.a,{container:!0,spacing:1,justify:"center"},l.a.createElement(f.a,{item:!0,lg:6,md:6,sm:12,xs:12,justify:"center"},l.a.createElement(I.a,{theme:Object(B.a)()},l.a.createElement(O.a,null,l.a.createElement(w.a,{action:l.a.createElement(b.a,{"aria-label":"",onClick:ue},"x"),title:"ajout"===o?"Nouveau contrat":"Mise \xe0 jour de contrat",subheader:""}),l.a.createElement(S.a,{className:" px-6 pt-6 pb-6"}," ",l.a.createElement("form",{onSubmit:$(me)},l.a.createElement(f.a,{container:!0,spacing:4,direction:"column"},l.a.createElement(f.a,{item:!0},l.a.createElement(Q.a,{progress:ae,acceptedFiles:["*.*"],onUpload:e=>{var t;(t=e)&&oe.mutate({fichier:t,objet:"documentcontrat",handleprogress:ne})},onSupprimer:()=>{console.log("supprimer le fichier")},titre:"Fichier contrat .pdf(faire glisser ou cliquez ici pour charger)"})),l.a.createElement(f.a,{item:!0},y.isLoading?l.a.createElement(A.a,{message:"chargement des clients"}):l.a.createElement(R.a,{id:"client",name:"client",label:"Choisir un client",table:"client",control:Z,options:y.data["hydra:member"],error:_.client,valeur:null!==(u=null===G||void 0===G?void 0:G.client)&&void 0!==u?u:""})),l.a.createElement(f.a,{item:!0},T.isLoading?l.a.createElement(A.a,{message:"chargement des produits"}):l.a.createElement(R.a,{id:"produit",name:"produit",label:"Choisir un produit",table:"produit",control:Z,options:T.data["hydra:member"],error:_.produit,valeur:null!==(d=null===G||void 0===G?void 0:G.produit)&&void 0!==d?d:""})),l.a.createElement(f.a,{item:!0},l.a.createElement(L.a,{id:"numero",nom:"numero",label:"Num\xe9ro du kit",valeur:null===G||void 0===G?void 0:G.numero,control:Z,error:_.numero}))))),l.a.createElement(N.a,null,l.a.createElement(f.a,{container:!0,alignItems:"center",justify:"space-between"},l.a.createElement(f.a,{item:!0},l.a.createElement(p.a,{color:"primary",variant:"contained",type:"submit",onClick:$(me)},j.isLoading||E.isLoading?l.a.createElement(x.a,{color:"inherit"}):l.a.createElement(g.a,null,"send"),l.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===o?l.a.createElement(h.a,null,"Enregistrer"):l.a.createElement(h.a,null,"Mettre \xe0 jour")))),l.a.createElement(f.a,{item:!0},l.a.createElement(p.a,{variant:"outlined",color:"secondary",onClick:ue},"Annuler")))))))))}var K=a(204),V=a(230),Y=a(300),H=(a(443),a(1192)),X=a(2285),Z=a(3),$=a(110),_=a(2267),ee=a(2191),te=(a(187),a(3099)),ae=a(434),re=a(71);Object($.a)(e=>{e.palette,Object(o.a)(e,["palette"]);return{userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185},userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185}}});t.default=()=>{const e=new URLSearchParams(window.location.search).get("telephone"),t=Object(re.g)(),a=Object(i.useState)({id:0,numero:"",statut:"",client:{id:0,telephone:null==e?"":e}}),o=Object(n.a)(a,2),c=o[0],y=o[1],C=Object(i.useState)({page:0,rowsPerPage:20,recherche:"",filtre:""}),w=Object(n.a)(C,2),S=w[0],N=w[1],x=Object(M.useQueryClient)(),P=Object(M.useQuery)(["Contrats",S.page,S.rowsPerPage,S.recherche,S.filtre,c],()=>Object(D.b)(S.page,S.rowsPerPage,S.recherche,S.filtre,c),{keepPreviousData:!0}),L=P.isLoading,R=(P.isFetching,P.isError),Q=P.error,q=P.data,F=Object(M.useMutation)(D.d,{onSuccess:()=>{ue({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{ue({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{x.invalidateQueries("Contrats")}}),T=[{id:0,nom:"Action"},{id:1,nom:"Modifier"},{id:2,nom:"Nouvelle demande"}],z=(e,a,r)=>{switch(console.log("haldle de laction::: "+e.target.value+"contrat::"+r),e.target.value){case"Modifier":Oe(r);break;case"Nouvelle demande":(e=>{t.push("/gestion/requetes?id="+e.client.id)})(r)}"Modifier"===e.target.value&&Oe(r)},U=Object(i.useState)(null),W=Object(n.a)(U,2),J=W[0],$=W[1],ne=Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),oe=Object(n.a)(ne,2),ie=oe[0],le=oe[1],ce=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>fe()}),se=Object(n.a)(ce,2),me=se[0],ue=se[1],de=Object(i.useState)("Liste des contrats"),pe=Object(n.a)(de,2),be=pe[0],ge=pe[1],ve=Object(i.useState)(!1),Ee=Object(n.a)(ve,2),he=Ee[0],je=Ee[1],Oe=e=>{le({mode:"edition",action:"misajour",affichageTable:!1}),$(e),ge("Mise \xe0 jour de contrat"),console.log(e)},fe=()=>{ue(Object(r.a)(Object(r.a)({},k.a),{},{open:!1}))},ye=e=>{window.open(B.f+"/contrat/download/"+e.document)},Ce=Object(i.useState)({open:!1,fichier:"",titre:""}),we=Object(n.a)(Ce,2),Se=we[0],Ne=we[1],xe=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"client",label:"client",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>{var r;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"flex items-center"},l.a.createElement(u.a,{variant:"rounded",className:"w-48 h-48",src:B.f+"/fichiers/photoclient/"+e.photo}),l.a.createElement("div",{className:"ml-3"},l.a.createElement("h5",{className:"my-0 text-15"},("MALE"===e.civilite?"M. ":"Mme. ")+e.nom+" "+(null!==(r=null===e||void 0===e?void 0:e.prenom)&&void 0!==r?r:"")),l.a.createElement("small",{className:"text-muted"},e.telephone),l.a.createElement("br",null),l.a.createElement("small",{className:"text-muted"},e.email),l.a.createElement("small",{className:"text-muted"},e.quartier.nom))))}}},{name:"produit",label:"Produit",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.nom}},{name:"numero",label:"Num\xe9ro du kit",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>l.a.createElement("strong",null,e)}},{name:"datededebut",label:"Date de debut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(X.a)(e),"dd/MM/yyyy hh:mm")}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>l.a.createElement("small",{className:Object(Z.default)({"border-radius-4  text-white px-2 py-2px":!0,"bg-secondary":"UNLOCKED"===e,"bg-error":"DISABLED"===e,"bg-green":"ENABLED"===e})},e)}},{name:"arrieres",label:"Arri\xe9r\xe9s",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"document",label:"Document",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>l.a.createElement(d.a,{onClick:null==e?()=>{}:()=>ye({id:t.rowData[0],document:e})},l.a.createElement(p.a,null,l.a.createElement(b.a,{size:"small",onClick:null==e?()=>{}:()=>ye({id:t.rowData[0],document:e})},l.a.createElement(g.a,{color:null==e?" ":"primary"}," preview"))))}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,t,a)=>l.a.createElement("div",null,l.a.createElement(ae.a,{label:"Action",value:"Action",id:String(t.rowData[0]),name:String(t.rowData[0]),variant:"outlined",key:t.rowData[0],onChange:e=>z(e,t.rowData[0],{id:t.rowData[0],client:t.rowData[1],produit:t.rowData[2],numero:t.rowData[3],datededebut:t.rowData[4],statut:t.rowData[5],document:t.rowData[6]})},T.map(e=>l.a.createElement(v.a,{key:e.id,value:e.nom},e.nom))))}}];return l.a.createElement("div",{className:"m-sm-30"},l.a.createElement(E.a,{open:Se.open,"aria-labelledby":"",maxWidth:"md",onClose:()=>{Ne(Object(r.a)(Object(r.a)({},Se),{},{open:!1}))}},l.a.createElement(_.a,{id:""},Se.titre),l.a.createElement(ee.a,null,l.a.createElement("img",{src:B.f+"/fichiers/documentcontrat/"+Se.fichier,alt:"documents",srcset:""}))),l.a.createElement(k.a,{message:me.message,severity:me.severity,open:me.open,handleAlertClose:fe}),l.a.createElement("div",{className:"mb-sm-30"},l.a.createElement(K.a,{routeSegments:[{name:"Gestion des contrats"}]})),l.a.createElement("div",{className:"mb-sm-30"},l.a.createElement(h.a,{variant:"h4"},be)),"affichage"===ie.mode?l.a.createElement(j.a,{in:ie.affichageTable,direction:"right",unmountOnExit:!0},l.a.createElement("div",null,l.a.createElement(p.a,{className:"mb-4",variant:"contained",color:"primary",onClick:()=>(le({mode:"edition",action:"ajout",affichageTable:!1}),$(null),void ge("Nouveau contrat"))},"Nouveau contrat"),l.a.createElement("div",{className:"mb-sm-30"},l.a.createElement(O.a,{className:"mb-sm-30"},l.a.createElement("form",null,l.a.createElement(f.a,{container:!0,spacing:2,direction:"column"},l.a.createElement(f.a,{item:!0},l.a.createElement(f.a,{container:!0,spacing:10,direction:"row"})),l.a.createElement(f.a,{item:!0},l.a.createElement(f.a,{container:!0,spacing:5,direction:"row"},l.a.createElement(f.a,{item:!0,sm:1}),l.a.createElement(f.a,{item:!0,sm:3,p:5},l.a.createElement(te.a,{id:"numero",nom:"numero",label:"Num\xe9ro de kit",value:c.numero,error:!1,onChange:e=>{y(Object(r.a)(Object(r.a)({},c),{},{numero:e.target.value}))}})),l.a.createElement(f.a,{item:!0,sm:3},l.a.createElement(te.a,{id:"telephone",nom:"telephone",label:"Num\xe9ro de t\xe9l\xe9phone",value:c.client.telephone,error:!1,onChange:e=>{y(Object(r.a)(Object(r.a)({},c),{},{client:Object(r.a)(Object(r.a)({},c.client),{},{telephone:e.target.value})}))}})),l.a.createElement(f.a,{item:!0,sm:3},l.a.createElement(te.a,{id:"statut",nom:"statut",label:"Statut",value:c.statut,error:!1,onChange:e=>{y(Object(r.a)(Object(r.a)({},c),{},{statut:e.target.value}))}})))),l.a.createElement(f.a,{item:!0}))))),L?l.a.createElement(A.a,{message:"Chargement des donn\xe9es",type:"info"}):R?l.a.createElement(A.a,{message:"Erreur lors du chargement des donn\xe9es::"+Q,type:"error"}):l.a.createElement(Y.a,{tag:"div",blocking:!1},l.a.createElement(I.a,{theme:Object(B.a)()},l.a.createElement(s.a,{title:be,data:q["hydra:member"],columns:xe,options:Object(r.a)(Object(r.a)({},m.a),{},{serverSide:!0,count:q["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:S.rowsPerPage,onChangePage:e=>(e=>{N(Object(r.a)(Object(r.a)({},S),{},{page:e})),x.invalidateQueries("Contrats")})(e),onChangeRowsPerPage:e=>(e=>{N(Object(r.a)(Object(r.a)({},S),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),x.invalidateQueries("Contrats")})(e),onSearchChange:e=>(e=>{var t;N(Object(r.a)(Object(r.a)({},S),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(t="texte a chercher"+e)&&void 0!==t?t:""),x.invalidateQueries("Contrats")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})}))),l.a.createElement(O.a,{className:"w-full overflow-auto",elevation:8},l.a.createElement(V.a,{open:he,onConfirmDialogClose:()=>{je(!1)},onYesClick:()=>{je(!1),F.mutate(J)},text:"Confirmez la suppression de "+(null===J||void 0===J?void 0:J.name)})))):l.a.createElement(G,{action:ie.action,lecontrat:J,handleFermeture:()=>{le({mode:"affichage",action:"nouveau",affichageTable:!0}),ge("Liste des contrats")}}))}}}]);