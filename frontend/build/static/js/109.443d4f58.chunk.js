(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[109],{3163:function(e,a,t){"use strict";t.r(a);var r=t(6),n=t(12),i=t(26),s=t(0),o=t.n(s),c=t(229),l=t.n(c),u=t(231),m=t(752),d=t(144),p=t(2302),j=t(224),b=t(606),h=t(1198),g=t(64),f=t(1241),v=t(1201),E=(t(95),t(79)),O=t(228),y=t(46),w=t(1204),C=t(1203),x=t(1202),S=t(783),M=t(8),P=t.n(M),k=t(19),D=t(17);function N(){return(N=Object(k.a)(P.a.mark((function e(a,t,r,n){var i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a+=1,e.next=3,D.b.get("/misajours?itemsPerPage="+t+"&page="+a+"&id="+r);case 3:return i=e.sent,e.abrupt("return",i.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return R.apply(this,arguments)}function R(){return(R=Object(k.a)(P.a.mark((function e(a){var t;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.b.post("/misajours",a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return F.apply(this,arguments)}function F(){return(F=Object(k.a)(P.a.mark((function e(a){var t;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.b.put("/misajours/"+a.id,a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return A.apply(this,arguments)}function A(){return(A=Object(k.a)(P.a.mark((function e(a){var t;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.b.delete("/misajours/"+a.id,{method:"DELETE",herdears:{Accept:"application/json"},data:a.id});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=t(73),L=t(84),T=t(32),W=t(117),J=(t(131),t(368),t(369)),_=t(60),q=(t(265),t(444),t(1196)),U=t(367);const V=E.b().shape({});function Y({id:e,lemisajour:a,handleFermeture:t,action:i}){var c,l,u;const m=Object(T.useQueryClient)(),p=Object(T.useMutation)(Q,{onSuccess:()=>{m.invalidateQueries("Misajours"),R({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{m.invalidateQueries("Misajours"),R({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),h=Object(T.useMutation)(I,{onSuccess:()=>{m.invalidateQueries("Misajours"),R({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{m.invalidateQueries("Misajours"),R({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),f=Object(s.useState)(a),E=Object(n.a)(f,2),M=E[0],P=(E[1],Object(s.useState)({severity:"severity",message:"",open:!1,automaticClose:!0})),k=Object(n.a)(P,2),N=k[0],R=k[1],F=Object(B.c)({resolver:Object(O.yupResolver)(V),defaultValues:Object(r.a)(Object(r.a)({},a),{},{id:null!==(c=null===a||void 0===a?void 0:a.id)&&void 0!==c?c:"",datemisajour:null!==(l=null===a||void 0===a?void 0:a.datemisajour)&&void 0!==l?l:new Date,commentaire:null!==(u=null===a||void 0===a?void 0:a.commentaire)&&void 0!==u?u:""})}),z=F.control,A=F.handleSubmit,_=F.errors,Y=(F.reset,Object(s.useState)(0)),G=Object(n.a)(Y,2),H=G[0],K=G[1],X=e=>{var a=Math.round(100*e.loaded/e.total);K(a)},Z=Object(T.useMutation)(U.a,{onSuccess:e=>{te(Object(r.a)(Object(r.a)({},ae),{},{fichier:e})),R(Object(r.a)(Object(r.a)({},N),{},{automaticClose:!1,message:"Fichier fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{R(Object(r.a)(Object(r.a)({},N),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),$=Object(s.useState)({}),ee=Object(n.a)($,2),ae=ee[0],te=ee[1],re=e=>{let a=Object(r.a)(Object(r.a)(Object(r.a)({},M),e),ae);M?h.mutate(Object(r.a)({},a)):p.mutate(Object(r.a)({},a))};function ne(){t()}return o.a.createElement("div",null,o.a.createElement(L.a,{message:N.message,severity:N.severity,open:N.open,handleAlertClose:N.automaticClose?t:()=>R(Object(r.a)(Object(r.a)({},N),{},{open:!1}))}),o.a.createElement(y.a,{container:!0,spacing:1,justify:"center"},o.a.createElement(y.a,{item:!0,lg:6,md:6,sm:12,xs:12,justify:"center"},o.a.createElement(q.a,{theme:Object(D.a)()},o.a.createElement(v.a,null,o.a.createElement(w.a,{action:o.a.createElement(j.a,{"aria-label":"",onClick:ne},"x"),title:"ajout"===i?"Nouvelle mise \xe0 jour":"Mise \xe0 jour de misajour",subheader:""}),o.a.createElement(C.a,{className:" px-6 pt-6 pb-6"}," ",o.a.createElement("form",{onSubmit:A(re)},o.a.createElement(y.a,{container:!0,spacing:4,direction:"column"},o.a.createElement(y.a,{item:!0},o.a.createElement(J.a,{progress:H,acceptedFiles:[".xlsx"],onUpload:e=>{var a;(a=e)&&Z.mutate({fichier:a,objet:"fichiermisajour",handleprogress:X})},onSupprimer:()=>{console.log("supprimer le fichier")},titre:"Fichier fichier .xlsx(faire glisser ou cliquez ici pour charger)"})),o.a.createElement(y.a,{item:!0},o.a.createElement(W.a,{id:"commentaire",nom:"commentaire",label:"Commentaire",valeur:null===M||void 0===M?void 0:M.commentaire,control:z,error:_.commentaire,multiline:!0,rows:4}))))),o.a.createElement(x.a,null,o.a.createElement(y.a,{container:!0,alignItems:"center",justify:"space-between"},o.a.createElement(y.a,{item:!0},o.a.createElement(d.a,{color:"primary",variant:"contained",type:"submit",onClick:A(re)},h.isLoading||p.isLoading?o.a.createElement(S.a,{color:"inherit"}):o.a.createElement(b.a,null,"send"),o.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===i?o.a.createElement(g.a,null,"Enregistrer"):o.a.createElement(g.a,null,"Mettre \xe0 jour")))),o.a.createElement(y.a,{item:!0},o.a.createElement(d.a,{variant:"outlined",color:"secondary",onClick:ne},"Annuler")))))))))}var G=t(204),H=t(230),K=t(300),X=(t(443),t(1192)),Z=t(2285),$=t(3),ee=t(110),ae=t(2267),te=t(2191);Object(ee.a)(e=>{e.palette,Object(i.a)(e,["palette"]);return{userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185},userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185}}});a.default=()=>{const e=Object(s.useState)({page:0,rowsPerPage:20,recherche:"",filtre:""}),a=Object(n.a)(e,2),t=a[0],i=a[1],c=Object(T.useQueryClient)(),E=Object(T.useQuery)(["Misajours",t.page,t.rowsPerPage,t.recherche,t.filtre],()=>function(e,a,t,r){return N.apply(this,arguments)}(t.page,t.rowsPerPage,t.recherche,t.filtre),{keepPreviousData:!0}),O=E.isLoading,y=(E.isFetching,E.isError),w=E.error,C=E.data,x=Object(T.useMutation)(z,{onSuccess:()=>{J({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{J({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{c.invalidateQueries("Misajours")}}),S=Object(s.useState)(null),M=Object(n.a)(S,2),P=M[0],k=M[1],Q=Object(s.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),R=Object(n.a)(Q,2),I=R[0],F=R[1],A=Object(s.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>ce()}),B=Object(n.a)(A,2),W=B[0],J=B[1],U=Object(s.useState)("Liste des misajours"),V=Object(n.a)(U,2),ee=V[0],re=V[1],ne=Object(s.useState)(!1),ie=Object(n.a)(ne,2),se=ie[0],oe=ie[1],ce=()=>{J(Object(r.a)(Object(r.a)({},L.a),{},{open:!1}))},le=Object(s.useState)({open:!1,fichier:"",titre:""}),ue=Object(n.a)(le,2),me=ue[0],de=ue[1],pe=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"datemisajour",label:"Date de mise \xe0 jour",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>null==e?" ":Object(X.a)(Object(Z.a)(e),"dd/MM/yyyy hh:mm")}},{name:"fichier",label:"Fichier",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>o.a.createElement(m.a,{onClick:()=>{de({open:!0,fichier:e,titre:"document"})}},o.a.createElement(d.a,null,o.a.createElement(p.a,{variant:"rounded",className:"w-48 h-48",src:D.f+"/fichiers/documentmisajour/"+e})))}},{name:"commentaire",label:"Commentaire",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>o.a.createElement("small",{className:Object($.default)({"border-radius-4  text-white px-2 py-2px":!0,"bg-green":"succ\xe8s"===e,"bg-error":"Echec"===e})},e)}},{name:"action",label:"Actions",options:{filter:!1,display:"excluded",sort:!1,customBodyRender:(e,a,t)=>o.a.createElement("div",null,o.a.createElement(j.a,{size:"small",onClick:()=>{(e=>{F({mode:"edition",action:"misajour",affichageTable:!1}),k(e),re("Mise \xe0 jour de misajour")})({id:a.rowData[0],datemisajour:a.rowData[1],fichier:a.rowData[2],commentaire:a.rowData[3],statut:a.rowData[4]})}},o.a.createElement(b.a,{color:"primary"},"edit")),o.a.createElement(j.a,{size:"small",onClick:()=>(e=>{oe(!0),k(e)})({id:a.rowData[0]})},o.a.createElement(b.a,{color:"error"},"delete")),o.a.createElement(j.a,{size:"small",onClick:()=>(a.rowData[0],void console.log("affichage de details"))},o.a.createElement(b.a,null,"arrow_right_alt")))}}];return o.a.createElement("div",{className:"m-sm-30"},o.a.createElement(h.a,{open:me.open,"aria-labelledby":"",maxWidth:"md",onClose:()=>{de(Object(r.a)(Object(r.a)({},me),{},{open:!1}))}},o.a.createElement(ae.a,{id:""},me.titre),o.a.createElement(te.a,null,o.a.createElement("img",{src:D.f+"/fichiers/documentmisajour/"+me.fichier,alt:"documents",srcset:""}))),o.a.createElement(L.a,{message:W.message,severity:W.severity,open:W.open,handleAlertClose:ce}),o.a.createElement("div",{className:"mb-sm-30"},o.a.createElement(G.a,{routeSegments:[{name:"Mise \xe0 jour des statuts des clients"}]})),o.a.createElement("div",{className:"mb-sm-30"},o.a.createElement(g.a,{variant:"h4"},ee)),"affichage"===I.mode?o.a.createElement(f.a,{in:I.affichageTable,direction:"right",unmountOnExit:!0},o.a.createElement("div",null,o.a.createElement(d.a,{className:"mb-4",variant:"contained",color:"primary",onClick:()=>(F({mode:"edition",action:"ajout",affichageTable:!1}),k(null),void re("Nouvelle mise \xe0 jour"))},"Nouvelle mise \xe0 jour"),O?o.a.createElement(_.a,{message:"Chargement des donn\xe9es",type:"info"}):y?o.a.createElement(_.a,{message:"Erreur lors du chargement des donn\xe9es::"+w,type:"error"}):o.a.createElement(K.a,{tag:"div",blocking:!1},o.a.createElement(q.a,{theme:Object(D.a)()},o.a.createElement(l.a,{title:ee,data:C["hydra:member"],columns:pe,options:Object(r.a)(Object(r.a)({},u.a),{},{serverSide:!0,count:C["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:t.rowsPerPage,onChangePage:e=>(e=>{i(Object(r.a)(Object(r.a)({},t),{},{page:e})),c.invalidateQueries("Misajours")})(e),onChangeRowsPerPage:e=>(e=>{i(Object(r.a)(Object(r.a)({},t),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),c.invalidateQueries("Misajours")})(e),onSearchChange:e=>(e=>{var a;i(Object(r.a)(Object(r.a)({},t),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(a="texte a chercher"+e)&&void 0!==a?a:""),c.invalidateQueries("Misajours")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})}))),o.a.createElement(v.a,{className:"w-full overflow-auto",elevation:8},o.a.createElement(H.a,{open:se,onConfirmDialogClose:()=>{oe(!1)},onYesClick:()=>{oe(!1),x.mutate(P)},text:"Confirmez la suppression de "+(null===P||void 0===P?void 0:P.name)})))):o.a.createElement(Y,{action:I.action,lemisajour:P,handleFermeture:()=>{F({mode:"affichage",action:"nouveau",affichageTable:!0}),re("Liste des misajours")}}))}}}]);