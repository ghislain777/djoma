(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[50],{2328:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return p}));var n=a(8),r=a.n(n),s=a(19),i=a(17);function c(e,t,a,n){return o.apply(this,arguments)}function o(){return(o=Object(s.a)(r.a.mark((function e(t,a,n,s){var c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,i.b.get("/caisses?itemsPerPage="+a+"&page="+t+"&id="+n);case 3:return c=e.sent,e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.post("/caisses",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.put("/caisses/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.delete("/caisses/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2339:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return p}));var n=a(8),r=a.n(n),s=a(19),i=a(17);function c(e,t,a,n){return o.apply(this,arguments)}function o(){return(o=Object(s.a)(r.a.mark((function e(t,a,n,s){var c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,i.b.get("/demandedecaisses?itemsPerPage="+a+"&page="+t+"&statut="+n);case 3:return c=e.sent,e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.post("/demandedecaisses",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.put("/demandedecaisses/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.delete("/demandedecaisses/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3184:function(e,t,a){"use strict";a.r(t);var n=a(6),r=a(12),s=a(26),i=a(0),c=a.n(i),o=a(229),l=a.n(o),u=a(231),d=a(752),m=a(144),p=a(2302),b=a(262),v=a(427),f=a(434),y=a(568),h=a(1198),j=a(46),g=a(1201),E=a(224),O=a(606),w=a(1241),x=(a(95),a(79)),D=a(228),S=a(1204),C=a(1203),P=a(1202),M=a(783),k=a(64),R=a(2339),A=a(73),N=a(84),Q=a(32),B=a(117),L=a(131),F=(a(368),a(369)),I=a(60),z=(a(265),a(444),a(17)),T=a(1196),q=a(367),W=a(150);const J=x.b().shape({montant:x.a().required("Montant requis").positive("Le Montant doit \xeatre positif").integer("Le Montant doit \xeatre un nombre entier")});function U({id:e,ledemandedecaisse:t,handleFermeture:a,action:s}){var o,l,u,d,p,b,v,f;const y=Object(Q.useQueryClient)(),h=Object(Q.useMutation)(R.a,{onSuccess:()=>{y.invalidateQueries("Demandedecaisses"),X({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{y.invalidateQueries("Demandedecaisses"),X({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),w=Object(Q.useMutation)(R.c,{onSuccess:()=>{y.invalidateQueries("Demandedecaisses"),X({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{y.invalidateQueries("Demandedecaisses"),X({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),x=Object(Q.useQuery)(["Utilisateurs",1],()=>Object(W.b)(0,100,"",""),{keepPreviousData:!0}),U=Object(i.useState)(t),V=Object(r.a)(U,2),Y=V[0],G=(V[1],Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0})),H=Object(r.a)(G,2),K=H[0],X=H[1],Z=Object(A.c)({resolver:Object(D.yupResolver)(J),defaultValues:Object(n.a)(Object(n.a)({},t),{},{id:null!==(o=null===t||void 0===t?void 0:t.id)&&void 0!==o?o:"",utilisateur:t?"/api/utilisateurs/"+t.utilisateur.id:"/api/utilisateurs/1",datedemande:null!==(l=null===t||void 0===t?void 0:t.datedemande)&&void 0!==l?l:new Date,motif:null!==(u=null===t||void 0===t?void 0:t.motif)&&void 0!==u?u:"",approuvele:null!==(d=null===t||void 0===t?void 0:t.approuvele)&&void 0!==d?d:new Date,payele:null!==(p=null===t||void 0===t?void 0:t.payele)&&void 0!==p?p:new Date,rejetele:null!==(b=null===t||void 0===t?void 0:t.rejetele)&&void 0!==b?b:new Date,annuleele:null!==(v=null===t||void 0===t?void 0:t.annuleele)&&void 0!==v?v:new Date})}),$=Z.control,_=Z.handleSubmit,ee=Z.errors,te=(Z.reset,Object(i.useState)(0)),ae=Object(r.a)(te,2),ne=ae[0],re=ae[1],se=e=>{var t=Math.round(100*e.loaded/e.total);re(t)},ie=Object(Q.useMutation)(q.a,{onSuccess:e=>{ue(Object(n.a)(Object(n.a)({},le),{},{document:e})),X(Object(n.a)(Object(n.a)({},K),{},{automaticClose:!1,message:"Fichier document charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{X(Object(n.a)(Object(n.a)({},K),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),ce=Object(i.useState)({}),oe=Object(r.a)(ce,2),le=oe[0],ue=oe[1],de=e=>{let t=Object(n.a)(Object(n.a)(Object(n.a)({},Y),e),le);Y?w.mutate(Object(n.a)({},t)):h.mutate(Object(n.a)({},t))};function me(){a()}return c.a.createElement("div",null,c.a.createElement(N.a,{message:K.message,severity:K.severity,open:K.open,handleAlertClose:K.automaticClose?a:()=>X(Object(n.a)(Object(n.a)({},K),{},{open:!1}))}),c.a.createElement(j.a,{container:!0,spacing:1,justify:"center"},c.a.createElement(j.a,{item:!0,lg:6,md:6,sm:12,xs:12,justify:"center"},c.a.createElement(T.a,{theme:Object(z.a)()},c.a.createElement(g.a,null,c.a.createElement(S.a,{action:c.a.createElement(E.a,{"aria-label":"",onClick:me},"x"),title:"ajout"===s?"Nouvelle demande":"Mise \xe0 jour de demandedecaisse",subheader:""}),c.a.createElement(C.a,{className:" px-6 pt-6 pb-6"}," ",c.a.createElement("form",{onSubmit:_(de)},c.a.createElement(j.a,{container:!0,spacing:4,direction:"column"},c.a.createElement(j.a,{item:!0},c.a.createElement(B.a,{id:"montant",nom:"montant",label:"Montant",valeur:null===Y||void 0===Y?void 0:Y.montant,control:$,error:ee.montant})),c.a.createElement(j.a,{item:!0},c.a.createElement(B.a,{id:"motif",nom:"motif",label:"Motif",valeur:null===Y||void 0===Y?void 0:Y.motif,control:$,error:ee.motif,multiline:!0,rows:4})),c.a.createElement(j.a,{item:!0},x.isLoading?c.a.createElement(I.a,{message:"chargement des utilisateurs"}):c.a.createElement(L.a,{id:"utilisateur",name:"utilisateur",label:"Demandeur",table:"utilisateur",control:$,options:x.data["hydra:member"],error:ee.utilisateur,valeur:null!==(f=null===Y||void 0===Y?void 0:Y.utilisateur)&&void 0!==f?f:""})),c.a.createElement(j.a,{item:!0},c.a.createElement(F.a,{progress:ne,acceptedFiles:["*.*"],onUpload:e=>{var t;(t=e)&&ie.mutate({fichier:t,objet:"documentdemandedecaisse",handleprogress:se})},onSupprimer:()=>{console.log("supprimer le fichier")},titre:"Fichier joint (faire glisser ou cliquez ici pour charger)"}))))),c.a.createElement(P.a,null,c.a.createElement(j.a,{container:!0,alignItems:"center",justify:"space-between"},c.a.createElement(j.a,{item:!0},c.a.createElement(m.a,{color:"primary",variant:"contained",type:"submit",onClick:_(de)},w.isLoading||h.isLoading?c.a.createElement(M.a,{color:"inherit"}):c.a.createElement(O.a,null,"send"),c.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===s?c.a.createElement(k.a,null,"Enregistrer"):c.a.createElement(k.a,null,"Mettre \xe0 jour")))),c.a.createElement(j.a,{item:!0},c.a.createElement(m.a,{variant:"outlined",color:"secondary",onClick:me},"Annuler")))))))))}var V=a(204),Y=a(230),G=a(300),H=(a(443),a(1192)),K=a(2285),X=a(3),Z=a(110),$=a(2267),_=a(2191),ee=a(68),te=a(2328);Object(Z.a)(e=>{e.palette,Object(s.a)(e,["palette"]);return{userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185}}});t.default=()=>{const e=Object(i.useState)({page:0,rowsPerPage:20,recherche:"Approuv\xe9e",filtre:""}),t=Object(r.a)(e,2),a=t[0],s=t[1],o=Object(Q.useQueryClient)(),x=Object(Q.useQuery)(["Demandedecaisses",a.page,a.rowsPerPage,a.recherche,a.filtre],()=>Object(R.b)(a.page,a.rowsPerPage,a.recherche,a.filtre),{keepPreviousData:!0}),D=x.isLoading,S=(x.isFetching,x.isError),C=x.error,P=x.data,M=Object(Q.useMutation)(R.d,{onSuccess:()=>{se({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{se({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{o.invalidateQueries("Demandedecaisses")}}),k=Object(Q.useQuery)(["caisses",1],()=>Object(te.b)(0,100,"",""),{keepPreviousData:!0}),A=Object(Q.useMutation)(R.c,{onSuccess:()=>{o.invalidateQueries("Demandedecaisses"),o.invalidateQueries("caisses"),se({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{o.invalidateQueries("Demandedecaisses"),se({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),B=Object(i.useState)(null),L=Object(r.a)(B,2),F=L[0],q=(L[1],Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0})),W=Object(r.a)(q,2),J=W[0],Z=W[1],ae=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>be()}),ne=Object(r.a)(ae,2),re=ne[0],se=ne[1],ie=Object(i.useState)("Demandes \xe0 payer"),ce=Object(r.a)(ie,2),oe=ce[0],le=ce[1],ue=Object(i.useState)(!1),de=Object(r.a)(ue,2),me=de[0],pe=de[1],be=()=>{se(Object(n.a)(Object(n.a)({},N.a),{},{open:!1}))},ve=Object(i.useState)({open:!1,fichier:"",titre:""}),fe=Object(r.a)(ve,2),ye=fe[0],he=fe[1],je=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"utilisateur",label:"Demandeur",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>{var n,r;return null!==(n=null!==(r=null===e||void 0===e?void 0:e.nom)&&void 0!==r?r:0+(null===e||void 0===e?void 0:e.prenom))&&void 0!==n?n:""}}},{name:"montant",label:"Montant",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.toLocaleString("fr-FR")}},{name:"datedemande",label:"Date de la demande",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"motif",label:"Motif",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"approuvele",label:"Approuv\xe9 le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"payele",label:"Pay\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"rejetele",label:"Rejet\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"annuleele",label:"Annul\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>c.a.createElement("small",{className:Object(X.default)({"border-radius-4  text-white px-2 py-2px":!0,"bg-primary":"Nouveau"===e,"bg-error":"Annul\xe9e"===e,"bg-light-green":"Approuv\xe9e"===e,"bg-green":"Pay\xe9e"===e,"bg-secondary":"Rejet\xe9e"===e})},e)}},{name:"document",label:"Document",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>c.a.createElement(d.a,{onClick:()=>{he({open:!0,fichier:e,titre:"document"})}},c.a.createElement(m.a,null,c.a.createElement(p.a,{variant:"rounded",className:"w-48 h-48",src:z.f+"/fichiers/documentdemandedecaisse/"+e})))}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,t,a)=>c.a.createElement("div",null,c.a.createElement(b.a,{size:"small",sx:{m:1,minWidth:200}},c.a.createElement(v.a,{id:"demo-simple-select-label"},"Actions"),c.a.createElement(f.a,{value:"",id:String(t.rowData[0]),name:String(t.rowData[0]),variant:"outlined",label:"Actions",key:t.rowData[0],onChange:e=>((e,t)=>{""!==e.target.value&&A.mutate({id:t,statut:e.target.value})})(e,t.rowData[0])},(e=>{switch(e){case"Annul\xe9e":return[];case"Approuv\xe9e":return[{id:4,nom:"Payer",statut:"Pay\xe9e"}];case"Pay\xe9e":case"Rejet\xe9e":return[];case"Nouveau":return[{id:1,nom:"Annuler",statut:"Annul\xe9e"},{id:2,nom:"Rejeter",statut:"Rejet\xe9e"},{id:3,nom:"Approuver",statut:"Approuv\xe9e"}]}return[]})(t.rowData[9]).map(e=>c.a.createElement(y.a,{key:e.id,value:e.statut},e.nom)))))}}];return c.a.createElement("div",{className:"m-sm-30"},c.a.createElement(h.a,{open:ye.open,"aria-labelledby":"",maxWidth:"md",onClose:()=>{he(Object(n.a)(Object(n.a)({},ye),{},{open:!1}))}},c.a.createElement($.a,{id:""},ye.titre),c.a.createElement(_.a,null,c.a.createElement("img",{src:z.f+"/fichiers/documentdemandedecaisse/"+ye.fichier,alt:"documents",srcset:""}))),c.a.createElement(N.a,{message:re.message,severity:re.severity,open:re.open,handleAlertClose:be}),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(V.a,{routeSegments:[{name:"Demandes \xe0 payer"}]})),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(j.a,{container:!0,spacing:"3"},c.a.createElement(j.a,{key:"stat",item:!0,md:3,sm:6,xs:12},c.a.createElement(ee.a,{to:"/caisse/mouvementdecaisse"},c.a.createElement(g.a,{elevation:3,className:"p-5 flex"},c.a.createElement("div",null,c.a.createElement(E.a,{size:"small",className:"p-2 bg-light-gray"},c.a.createElement(O.a,{className:"text-muted",color:"success"},"wallet"))),c.a.createElement("div",{className:"ml-4"},c.a.createElement("h3",{className:"mt-1 text-32"},k.isLoading?c.a.createElement(I.a,{message:"chargement..."}):k.data["hydra:member"][0].solde.toLocaleString("fr-FR")),c.a.createElement("p",{className:"m-0 text-muted"},"SOLDE DE CAISSE"))))))),"affichage"===J.mode?c.a.createElement(w.a,{in:J.affichageTable,direction:"right",unmountOnExit:!0},c.a.createElement("div",null,D?c.a.createElement(I.a,{message:"Chargement des donn\xe9es",type:"info"}):S?c.a.createElement(I.a,{message:"Erreur lors du chargement des donn\xe9es::"+C,type:"error"}):c.a.createElement(G.a,{tag:"div",blocking:!1},c.a.createElement(T.a,{theme:Object(z.a)()},c.a.createElement(l.a,{title:oe,data:P["hydra:member"],columns:je,options:Object(n.a)(Object(n.a)({},u.a),{},{serverSide:!0,count:P["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:a.rowsPerPage,onChangePage:e=>(e=>{s(Object(n.a)(Object(n.a)({},a),{},{page:e})),o.invalidateQueries("Demandedecaisses")})(e),onChangeRowsPerPage:e=>(e=>{s(Object(n.a)(Object(n.a)({},a),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),o.invalidateQueries("Demandedecaisses")})(e),onSearchChange:e=>(e=>{var t;s(Object(n.a)(Object(n.a)({},a),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(t="texte a chercher"+e)&&void 0!==t?t:""),o.invalidateQueries("Demandedecaisses")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})}))),c.a.createElement(g.a,{className:"w-full overflow-auto",elevation:8},c.a.createElement(Y.a,{open:me,onConfirmDialogClose:()=>{pe(!1)},onYesClick:()=>{pe(!1),M.mutate(F)},text:"Confirmez la suppression de "+(null===F||void 0===F?void 0:F.name)})))):c.a.createElement(U,{action:J.action,ledemandedecaisse:F,handleFermeture:()=>{Z({mode:"affichage",action:"nouveau",affichageTable:!0}),le("Demandes \xe0 payer")}}))}}}]);