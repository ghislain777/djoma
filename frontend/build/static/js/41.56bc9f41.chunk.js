(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[41],{2369:function(e,a,t){"use strict";t.d(a,"b",(function(){return o})),t.d(a,"a",(function(){return l})),t.d(a,"c",(function(){return m})),t.d(a,"d",(function(){return p}));var r=t(8),n=t.n(r),i=t(19),c=t(17);function o(e,a,t,r){return s.apply(this,arguments)}function s(){return(s=Object(i.a)(n.a.mark((function e(a,t,r,i){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a+=1,e.next=3,c.b.get("/archives?itemsPerPage="+t+"&page="+a+"&id="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(i.a)(n.a.mark((function e(a){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.post("/archives",a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return d.apply(this,arguments)}function d(){return(d=Object(i.a)(n.a.mark((function e(a){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.put("/archives/"+a.id,a);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return v.apply(this,arguments)}function v(){return(v=Object(i.a)(n.a.mark((function e(a){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.delete("/archives/"+a.id,{method:"DELETE",herdears:{Accept:"application/json"},data:a.id});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2450:function(e,a,t){"use strict";t.d(a,"a",(function(){return o}));var r=t(8),n=t.n(r),i=t(19),c=t(17);function o(e,a,t,r){return s.apply(this,arguments)}function s(){return(s=Object(i.a)(n.a.mark((function e(a,t,r,i){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a+=1,e.next=3,c.b.get("/typedocuments?itemsPerPage="+t+"&page="+a+"&id="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2451:function(e,a,t){"use strict";t.d(a,"a",(function(){return o}));var r=t(8),n=t.n(r),i=t(19),c=t(17);function o(e,a,t,r){return s.apply(this,arguments)}function s(){return(s=Object(i.a)(n.a.mark((function e(a,t,r,i){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a+=1,e.next=3,c.b.get("/agences?itemsPerPage="+t+"&page="+a+"&id="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3179:function(e,a,t){"use strict";t.r(a);var r=t(6),n=t(12),i=t(0),c=t.n(i),o=t(229),s=t.n(o),l=t(231),u=t(224),m=t(606),d=t(64),p=t(1241),v=t(144),h=t(1201),b=t(46),g=t(79),f=t(228),y=t(783),E=t(2369),j=t(73),O=t(84),w=t(32),C=t(117),P=t(131),A=(t(368),t(369)),S=t(367),k=t(2450),x=t(2451),D=t(60),L=t(267);const Q=g.b().shape({typedocument:g.c().required("Le champs Type de document est requis"),agence:g.c().required("Le champs Agence est requis"),compte:g.c().required("Le champs Compte client est requis"),anneedarchive:g.a().positive("L'ann\xe9e doit \xeatre un entier positif").integer("L'ann\xe9e doit \xeatre un entier positif").required("Le champs Ann\xe9e est requis"),moisdarchive:g.a().required("Le champs Mois est requis")});function R({id:e,learchive:a,handleFermeture:t,action:o}){var s,l;const u=Object(w.useQueryClient)(),p=Object(i.useState)(a),h=Object(n.a)(p,2),g=h[0],R=(h[1],Object(L.a)().utilisateur),M=Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0}),q=Object(n.a)(M,2),B=q[0],N=q[1],T=Object(w.useMutation)(E.a,{onSuccess:()=>{u.invalidateQueries("Archives"),N({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{u.invalidateQueries("Archives"),N({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),F=Object(w.useMutation)(E.c,{onSuccess:()=>{u.invalidateQueries("Archives"),N({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{u.invalidateQueries("Archives"),N({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),z=Object(w.useQuery)(["Roles",1],()=>Object(k.a)(0,100,"",""),{keepPreviousData:!0}),I=z.isLoading,J=(z.isFetching,z.isError,z.error,z.data),_=Object(w.useQuery)(["Agences",1],()=>Object(x.a)(0,100,"",""),{keepPreviousData:!0}),G=Object(w.useMutation)(S.a,{onSuccess:e=>{N(Object(r.a)(Object(r.a)({},B),{},{automaticClose:!1,message:"Fichier charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{N(Object(r.a)(Object(r.a)({},B),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),U=Object(j.c)({resolver:Object(f.yupResolver)(Q)}),Y=U.control,H=U.handleSubmit,K=U.errors,V=(U.reset,e=>{let a=Object(r.a)(Object(r.a)(Object(r.a)({},g),e),{},{fichier:G.data,utilisateur:"/api/utilisateurs/"+R.id});g?F.mutate(Object(r.a)({},a)):T.mutate(Object(r.a)({},a))});return c.a.createElement("div",null,c.a.createElement(O.a,{message:B.message,severity:B.severity,open:B.open,handleAlertClose:B.automaticClose?t:()=>N(Object(r.a)(Object(r.a)({},B),{},{open:!1}))}),c.a.createElement("form",{onSubmit:H(V)},c.a.createElement(b.a,{container:!0,spacing:4,direction:"column"},c.a.createElement(b.a,{item:!0},c.a.createElement(A.a,{onUpload:e=>{var a;(a=e)&&G.mutate({fichier:a,objet:"archive"})},onSupprimer:()=>{alert("suppression du fichier")}})),c.a.createElement(b.a,{item:!0},I?c.a.createElement(D.a,{message:"chargement"}):c.a.createElement(P.a,{id:"typedocument",name:"typedocument",label:"Choisir le type de document",table:"typedocument",control:Y,options:J["hydra:member"],error:K.typedocument,valeur:null!==(s=null===g||void 0===g?void 0:g.typedocument)&&void 0!==s?s:""})),c.a.createElement(b.a,{item:!0},_.isLoading?c.a.createElement(D.a,{message:"chargement"}):c.a.createElement(P.a,{id:"agence",name:"agence",label:"Choisir l'agence'",table:"agence",control:Y,options:_.data["hydra:member"],error:K.agence,valeur:null!==(l=null===g||void 0===g?void 0:g.agence)&&void 0!==l?l:""})),c.a.createElement(b.a,{item:!0},c.a.createElement(C.a,{id:"compte",nom:"compte",label:"Compte client",valeur:null===g||void 0===g?void 0:g.compte,control:Y,error:K.compte})),c.a.createElement(b.a,{item:!0},c.a.createElement(C.a,{id:"anneedarchive",nom:"anneedarchive",label:"Ann\xe9e de l'archive",valeur:null===g||void 0===g?void 0:g.anneedarchive,control:Y,error:K.anneedarchive})),c.a.createElement(b.a,{item:!0},c.a.createElement(C.a,{id:"moisdarchive",nom:"moisdarchive",label:"Mois de l'archive",valeur:null===g||void 0===g?void 0:g.moisdarchive,control:Y,error:K.moisdarchive})),c.a.createElement(b.a,{item:!0},c.a.createElement(b.a,{container:!0,alignItems:"center",justify:"space-between"},c.a.createElement(b.a,{item:!0},c.a.createElement(v.a,{color:"primary",variant:"contained",type:"submit",onClick:H(V)},F.isLoading||T.isLoading?c.a.createElement(y.a,{color:"inherit"}):c.a.createElement(m.a,null,"send"),c.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===o?c.a.createElement(d.a,null,"Enregistrer"):c.a.createElement(d.a,null,"Mettre \xe0 jour")))),c.a.createElement(b.a,{item:!0},c.a.createElement(v.a,{variant:"outlined",color:"secondary",onClick:function(){t()}},"Annuler")))))))}var M=t(204),q=t(230),B=t(300),N=(t(443),t(1192));a.default=()=>{const e=Object(i.useState)({page:0,rowsPerPage:3,recherche:"",filtre:""}),a=Object(n.a)(e,2),t=a[0],o=a[1],g=Object(w.useQueryClient)(),f=Object(w.useQuery)(["Archives",t.page,t.rowsPerPage,t.recherche,t.filtre],()=>Object(E.b)(t.page,t.rowsPerPage,t.recherche,t.filtre),{keepPreviousData:!0}),y=f.isLoading,j=(f.isFetching,f.isError),C=f.error,P=f.data,A=Object(w.useMutation)(E.d,{onSuccess:()=>{G({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{G({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{g.invalidateQueries("Archives")}}),S=Object(i.useState)(null),k=Object(n.a)(S,2),x=k[0],L=k[1],Q=Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0}),T=Object(n.a)(Q,2),F=T[0],z=T[1],I=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>$()}),J=Object(n.a)(I,2),_=J[0],G=J[1],U=Object(i.useState)("Liste des archives"),Y=Object(n.a)(U,2),H=Y[0],K=Y[1],V=Object(i.useState)(!1),W=Object(n.a)(V,2),X=W[0],Z=W[1],$=()=>{G(Object(r.a)(Object(r.a)({},O.a),{},{open:!1}))},ee=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"typedocument",label:"Type de document",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e.nom}},{name:"agence",label:"Agence",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e.nom}},{name:"utilisateur",label:"Cr\xe9\xe9\xe9 par",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e.nom+" "+e.prenom}},{name:"compte",label:"Compte client",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"creele",label:"Cr\xe9\xe9e le",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>Object(N.a)(Date.parse(e),"dd/MM/yyyy")}},{name:"fichier",label:"Fichier",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"anneedarchive",label:"Ann\xe9e",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"moisdarchive",label:"Mois",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,a,t)=>e}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,a,t)=>c.a.createElement("div",null,c.a.createElement(u.a,{size:"small",onClick:()=>{(e=>{z({mode:"edition",action:"misajour",affichageTable:!1}),L(e),K("Mise \xe0 jour du archive}")})({id:a.rowData[0],typedocument:a.rowData[1],agence:a.rowData[2],utilisateur:a.rowData[3],compte:a.rowData[4],creele:a.rowData[5],fichier:a.rowData[6],anneedarchive:a.rowData[7],moisdarchive:a.rowData[8]})}},c.a.createElement(m.a,{color:"primary"},"edit")),c.a.createElement(u.a,{size:"small",onClick:()=>(e=>{Z(!0),L(e)})({id:a.rowData[0]})},c.a.createElement(m.a,{color:"error"},"delete")),c.a.createElement(u.a,{size:"small",onClick:()=>(a.rowData[0],void console.log("affichage de details"))},c.a.createElement(m.a,null,"arrow_right_alt")))}}];return c.a.createElement("div",{className:"m-sm-30"},c.a.createElement(O.a,{message:_.message,severity:_.severity,open:_.open,handleAlertClose:$}),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(M.a,{routeSegments:[{name:"Gestion des archives"}]})),c.a.createElement("div",{className:"mb-sm-30"},c.a.createElement(d.a,{variant:"h4"},H)),"affichage"===F.mode?c.a.createElement(p.a,{in:F.affichageTable,direction:"right",unmountOnExit:!0},c.a.createElement("div",null,c.a.createElement(v.a,{className:"mb-4",variant:"contained",color:"primary",onClick:()=>(z({mode:"edition",action:"ajout",affichageTable:!1}),L(null),void K("Nouveau document"))},"Nouveau document"),y?c.a.createElement(D.a,{message:"Chargement des donn\xe9es",type:"info"}):j?c.a.createElement(D.a,{message:"Erreur lors du chargement des donn\xe9es::"+C,type:"error"}):c.a.createElement(B.a,{tag:"div",blocking:!1},c.a.createElement(s.a,{title:H,data:P["hydra:member"],columns:ee,options:Object(r.a)(Object(r.a)({},l.a),{},{serverSide:!0,count:P["hydra:totalItems"],rowsPerPageOptions:[3,5,10],rowsPerPage:t.rowsPerPage,onChangePage:e=>(e=>{o(Object(r.a)(Object(r.a)({},t),{},{page:e})),g.invalidateQueries("Archives")})(e),onChangeRowsPerPage:e=>(e=>{o(Object(r.a)(Object(r.a)({},t),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),g.invalidateQueries("Archives")})(e),onSearchChange:e=>(e=>{var a;o(Object(r.a)(Object(r.a)({},t),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(a="texte a chercher"+e)&&void 0!==a?a:""),g.invalidateQueries("Archives")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})})),c.a.createElement(h.a,{className:"w-full overflow-auto",elevation:8},c.a.createElement(q.a,{open:X,onConfirmDialogClose:()=>{Z(!1)},onYesClick:()=>{Z(!1),A.mutate(x)},text:"Confirmez la suppression de "+(null===x||void 0===x?void 0:x.name)})))):c.a.createElement(b.a,{container:!0,spacing:6,alignContent:"center",justify:"center"},c.a.createElement(b.a,{item:!0,lg:6,md:6,sm:12,xs:12},c.a.createElement(h.a,{className:"px-6 pt-2 pb-4"},c.a.createElement(R,{action:F.action,learchive:x,handleFermeture:()=>{z({mode:"affichage",action:"nouveau",affichageTable:!0}),K("Liste des archives")}})))))}}}]);