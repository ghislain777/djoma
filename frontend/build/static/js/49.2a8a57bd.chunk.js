(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[49],{2328:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return p}));var r=a(8),n=a.n(r),s=a(19),i=a(17);function o(e,t,a,r){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(n.a.mark((function e(t,a,r,s){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,i.b.get("/caisses?itemsPerPage="+a+"&page="+t+"&id="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.post("/caisses",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.put("/caisses/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.delete("/caisses/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2339:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return p}));var r=a(8),n=a.n(r),s=a(19),i=a(17);function o(e,t,a,r){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(n.a.mark((function e(t,a,r,s){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t+=1,e.next=3,i.b.get("/demandedecaisses?itemsPerPage="+a+"&page="+t+"&statut="+r);case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.post("/demandedecaisses",t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.put("/demandedecaisses/"+t.id,t);case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.b.delete("/demandedecaisses/"+t.id,{method:"DELETE",herdears:{Accept:"application/json"},data:t.id});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},3183:function(e,t,a){"use strict";a.r(t);var r=a(6),n=a(12),s=a(26),i=a(0),o=a.n(i),c=a(229),l=a.n(c),u=a(231),d=a(752),m=a(144),p=a(2302),b=a(262),v=a(427),f=a(434),h=a(568),y=a(1198),j=a(46),g=a(1201),E=a(224),O=a(606),w=a(1241),D=(a(95),a(79)),x=a(228),S=a(1204),C=a(1203),P=a(1202),M=a(783),k=a(64),R=a(2339),A=a(73),N=a(84),Q=a(32),B=a(117),L=a(131),F=(a(368),a(369)),I=a(60),z=(a(265),a(444),a(17)),T=a(1196),W=a(367),q=a(150);const J=D.b().shape({montant:D.a().required("Montant requis").positive("Le Montant doit \xeatre positif").integer("Le Montant doit \xeatre un nombre entier")});function U({id:e,ledemandedecaisse:t,handleFermeture:a,action:s}){var c,l,u,d,p,b,v,f;const h=Object(Q.useQueryClient)(),y=Object(Q.useMutation)(R.a,{onSuccess:()=>{h.invalidateQueries("Demandedecaisses"),X({message:"Enregistrement r\xe9ussi",open:!0,severity:"success",automaticClose:!0})},onError:()=>{h.invalidateQueries("Demandedecaisses"),X({message:"Echec lors de l op\xe9ration",open:!0,severity:"error",automaticClose:!0})}}),w=Object(Q.useMutation)(R.c,{onSuccess:()=>{h.invalidateQueries("Demandedecaisses"),X({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{h.invalidateQueries("Demandedecaisses"),X({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),D=Object(Q.useQuery)(["Utilisateurs",1],()=>Object(q.b)(0,100,"",""),{keepPreviousData:!0}),U=Object(i.useState)(t),V=Object(n.a)(U,2),Y=V[0],G=(V[1],Object(i.useState)({severity:"severity",message:"",open:!1,automaticClose:!0})),H=Object(n.a)(G,2),K=H[0],X=H[1],Z=Object(A.c)({resolver:Object(x.yupResolver)(J),defaultValues:Object(r.a)(Object(r.a)({},t),{},{id:null!==(c=null===t||void 0===t?void 0:t.id)&&void 0!==c?c:"",utilisateur:t?"/api/utilisateurs/"+t.utilisateur.id:"/api/utilisateurs/1",datedemande:null!==(l=null===t||void 0===t?void 0:t.datedemande)&&void 0!==l?l:new Date,motif:null!==(u=null===t||void 0===t?void 0:t.motif)&&void 0!==u?u:"",approuvele:null!==(d=null===t||void 0===t?void 0:t.approuvele)&&void 0!==d?d:new Date,payele:null!==(p=null===t||void 0===t?void 0:t.payele)&&void 0!==p?p:new Date,rejetele:null!==(b=null===t||void 0===t?void 0:t.rejetele)&&void 0!==b?b:new Date,annuleele:null!==(v=null===t||void 0===t?void 0:t.annuleele)&&void 0!==v?v:new Date})}),$=Z.control,_=Z.handleSubmit,ee=Z.errors,te=(Z.reset,Object(i.useState)(0)),ae=Object(n.a)(te,2),re=ae[0],ne=ae[1],se=e=>{var t=Math.round(100*e.loaded/e.total);ne(t)},ie=Object(Q.useMutation)(W.a,{onSuccess:e=>{ue(Object(r.a)(Object(r.a)({},le),{},{document:e})),X(Object(r.a)(Object(r.a)({},K),{},{automaticClose:!1,message:"Fichier document charg\xe9 sur le serveur",open:!0,severity:"success"}))},onError:()=>{X(Object(r.a)(Object(r.a)({},K),{},{automaticClose:!1,message:"Echec de chargement du fichier sur le serveur",open:!0,severity:"error"}))}}),oe=Object(i.useState)({}),ce=Object(n.a)(oe,2),le=ce[0],ue=ce[1],de=e=>{let t=Object(r.a)(Object(r.a)(Object(r.a)({},Y),e),le);Y?w.mutate(Object(r.a)({},t)):y.mutate(Object(r.a)({},t))};function me(){a()}return o.a.createElement("div",null,o.a.createElement(N.a,{message:K.message,severity:K.severity,open:K.open,handleAlertClose:K.automaticClose?a:()=>X(Object(r.a)(Object(r.a)({},K),{},{open:!1}))}),o.a.createElement(j.a,{container:!0,spacing:1,justify:"center"},o.a.createElement(j.a,{item:!0,lg:6,md:6,sm:12,xs:12,justify:"center"},o.a.createElement(T.a,{theme:Object(z.a)()},o.a.createElement(g.a,null,o.a.createElement(S.a,{action:o.a.createElement(E.a,{"aria-label":"",onClick:me},"x"),title:"ajout"===s?"Nouvelle demande":"Mise \xe0 jour de demandedecaisse",subheader:""}),o.a.createElement(C.a,{className:" px-6 pt-6 pb-6"}," ",o.a.createElement("form",{onSubmit:_(de)},o.a.createElement(j.a,{container:!0,spacing:4,direction:"column"},o.a.createElement(j.a,{item:!0},o.a.createElement(B.a,{id:"montant",nom:"montant",label:"Montant",valeur:null===Y||void 0===Y?void 0:Y.montant,control:$,error:ee.montant})),o.a.createElement(j.a,{item:!0},o.a.createElement(B.a,{id:"motif",nom:"motif",label:"Motif",valeur:null===Y||void 0===Y?void 0:Y.motif,control:$,error:ee.motif,multiline:!0,rows:4})),o.a.createElement(j.a,{item:!0},D.isLoading?o.a.createElement(I.a,{message:"chargement des utilisateurs"}):o.a.createElement(L.a,{id:"utilisateur",name:"utilisateur",label:"Demandeur",table:"utilisateur",control:$,options:D.data["hydra:member"],error:ee.utilisateur,valeur:null!==(f=null===Y||void 0===Y?void 0:Y.utilisateur)&&void 0!==f?f:""})),o.a.createElement(j.a,{item:!0},o.a.createElement(F.a,{progress:re,acceptedFiles:["*.*"],onUpload:e=>{var t;(t=e)&&ie.mutate({fichier:t,objet:"documentdemandedecaisse",handleprogress:se})},onSupprimer:()=>{console.log("supprimer le fichier")},titre:"Fichier joint (faire glisser ou cliquez ici pour charger)"}))))),o.a.createElement(P.a,null,o.a.createElement(j.a,{container:!0,alignItems:"center",justify:"space-between"},o.a.createElement(j.a,{item:!0},o.a.createElement(m.a,{color:"primary",variant:"contained",type:"submit",onClick:_(de)},w.isLoading||y.isLoading?o.a.createElement(M.a,{color:"inherit"}):o.a.createElement(O.a,null,"send"),o.a.createElement("span",{className:"pl-2 capitalize"},"ajout"===s?o.a.createElement(k.a,null,"Enregistrer"):o.a.createElement(k.a,null,"Mettre \xe0 jour")))),o.a.createElement(j.a,{item:!0},o.a.createElement(m.a,{variant:"outlined",color:"secondary",onClick:me},"Annuler")))))))))}var V=a(204),Y=a(230),G=a(300),H=(a(443),a(1192)),K=a(2285),X=a(3),Z=a(110),$=a(2267),_=a(2191),ee=a(2328),te=a(68);Object(Z.a)(e=>{e.palette,Object(s.a)(e,["palette"]);return{userMenu:{display:"flex",alignItems:"center",cursor:"pointer",borderRadius:24,padding:4,"& span":{margin:"0 8px"}},menuItem:{display:"flex",alignItems:"center",minWidth:185}}});t.default=()=>{const e=Object(i.useState)({page:0,rowsPerPage:20,recherche:"Nouveau",filtre:""}),t=Object(n.a)(e,2),a=t[0],s=t[1],c=Object(Q.useQueryClient)(),D=Object(Q.useQuery)(["Demandedecaisses",a.page,a.rowsPerPage,a.recherche,a.filtre],()=>Object(R.b)(a.page,a.rowsPerPage,a.recherche,a.filtre),{keepPreviousData:!0}),x=D.isLoading,S=(D.isFetching,D.isError),C=D.error,P=D.data,M=Object(Q.useMutation)(R.d,{onSuccess:()=>{se({message:"Suppr\xe9ssion r\xe9ussi",open:!0,severity:"success"})},onError:()=>{se({message:"Echec lors de l op\xe9ration",open:!0,severity:"error"})},onSettled:()=>{c.invalidateQueries("Demandedecaisses")}}),k=Object(Q.useMutation)(R.c,{onSuccess:()=>{c.invalidateQueries("Demandedecaisses"),c.invalidateQueries("caisses"),se({message:"Mise \xe0 jour r\xe9ussie",open:!0,severity:"success",automaticClose:!0})},onError:()=>{c.invalidateQueries("Demandedecaisses"),se({message:"Echec lors de la mise \xe0 jour",open:!0,severity:"error",automaticClose:!0})}}),A=Object(Q.useQuery)(["caisses",1],()=>Object(ee.b)(0,100,"",""),{keepPreviousData:!0}),B=Object(i.useState)(null),L=Object(n.a)(B,2),F=L[0],W=(L[1],Object(i.useState)({mode:"affichage",action:"ajout",affichageTable:!0})),q=Object(n.a)(W,2),J=q[0],Z=q[1],ae=Object(i.useState)({severity:"severity",message:"",open:!1,handleCloseAlert:()=>be()}),re=Object(n.a)(ae,2),ne=re[0],se=re[1],ie=Object(i.useState)("Demandes \xe0 approuver"),oe=Object(n.a)(ie,2),ce=oe[0],le=oe[1],ue=Object(i.useState)(!1),de=Object(n.a)(ue,2),me=de[0],pe=de[1],be=()=>{se(Object(r.a)(Object(r.a)({},N.a),{},{open:!1}))},ve=Object(i.useState)({open:!1,fichier:"",titre:""}),fe=Object(n.a)(ve,2),he=fe[0],ye=fe[1],je=[{name:"id",label:"ID",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"utilisateur",label:"Demandeur",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>{var r,n;return null!==(r=null!==(n=null===e||void 0===e?void 0:e.nom)&&void 0!==n?n:0+(null===e||void 0===e?void 0:e.prenom))&&void 0!==r?r:""}}},{name:"montant",label:"Montant",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e.toLocaleString("fr-FR")}},{name:"datedemande",label:"Date de la demande",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"motif",label:"Motif",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>e}},{name:"approuvele",label:"Approuv\xe9 le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"payele",label:"Pay\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"rejetele",label:"Rejet\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"annuleele",label:"Annul\xe9e le",options:{filter:!1,sort:!1,display:!1,customBodyRender:(e,t,a)=>null==e?" ":Object(H.a)(Object(K.a)(e),"dd/MM/yyyy hh:mm")}},{name:"statut",label:"Statut",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>o.a.createElement("small",{className:Object(X.default)({"border-radius-4  text-white px-2 py-2px":!0,"bg-primary":"Nouveau"===e,"bg-error":"Annul\xe9e"===e,"bg-light-green":"Approuv\xe9e"===e,"bg-green":"Pay\xe9e"===e,"bg-secondary":"Rejet\xe9e"===e})},e)}},{name:"document",label:"Document",options:{filter:!1,sort:!1,display:!0,customBodyRender:(e,t,a)=>o.a.createElement(d.a,{onClick:()=>{ye({open:!0,fichier:e,titre:"document"})}},o.a.createElement(m.a,null,o.a.createElement(p.a,{variant:"rounded",className:"w-48 h-48",src:z.f+"/fichiers/documentdemandedecaisse/"+e})))}},{name:"action",label:"Actions",options:{filter:!1,sort:!1,customBodyRender:(e,t,a)=>o.a.createElement("div",null,o.a.createElement(b.a,{size:"small",sx:{m:1,minWidth:200}},o.a.createElement(v.a,{id:"demo-simple-select-label"},"Actions"),o.a.createElement(f.a,{value:"",id:String(t.rowData[0]),name:String(t.rowData[0]),variant:"outlined",label:"Actions",key:t.rowData[0],onChange:e=>((e,t)=>{""!==e.target.value&&k.mutate({id:t,statut:e.target.value})})(e,t.rowData[0])},(e=>{switch(e){case"Annul\xe9e":return[];case"Approuv\xe9e":return[{id:4,nom:"Payer",statut:"Pay\xe9e"}];case"Pay\xe9e":case"Rejet\xe9e":return[];case"Nouveau":return[{id:1,nom:"Annuler",statut:"Annul\xe9e"},{id:2,nom:"Rejeter",statut:"Rejet\xe9e"},{id:3,nom:"Approuver",statut:"Approuv\xe9e"}]}return[]})(t.rowData[9]).map(e=>o.a.createElement(h.a,{key:e.id,value:e.statut},e.nom)))))}}];return o.a.createElement("div",{className:"m-sm-30"},o.a.createElement(y.a,{open:he.open,"aria-labelledby":"",maxWidth:"md",onClose:()=>{ye(Object(r.a)(Object(r.a)({},he),{},{open:!1}))}},o.a.createElement($.a,{id:""},he.titre),o.a.createElement(_.a,null,o.a.createElement("img",{src:z.f+"/fichiers/documentdemandedecaisse/"+he.fichier,alt:"documents",srcset:""}))),o.a.createElement(N.a,{message:ne.message,severity:ne.severity,open:ne.open,handleAlertClose:be}),o.a.createElement("div",{className:"mb-sm-30"},o.a.createElement(V.a,{routeSegments:[{name:"Demandes \xe0 approuver"}]})),o.a.createElement("div",{className:"mb-sm-30"},o.a.createElement(j.a,{container:!0,spacing:"3"},o.a.createElement(j.a,{key:"stat",item:!0,md:3,sm:6,xs:12},o.a.createElement(te.a,{to:"/caisse/mouvementdecaisse"},o.a.createElement(g.a,{elevation:3,className:"p-5 flex"},o.a.createElement("div",null,o.a.createElement(E.a,{size:"small",className:"p-2 bg-light-gray"},o.a.createElement(O.a,{color:"primary"},"Wallet"))),o.a.createElement("div",{className:"ml-4"},o.a.createElement("h3",{className:"mt-1 text-25"},A.isLoading?o.a.createElement(I.a,{message:"chargement..."}):A.data["hydra:member"][0].solde.toLocaleString("fr-FR")),o.a.createElement("p",{className:"m-0 text-muted"},"SOLDE DE CAISSE")))))),"      "),"affichage"===J.mode?o.a.createElement(w.a,{in:J.affichageTable,direction:"right",unmountOnExit:!0},o.a.createElement("div",null,x?o.a.createElement(I.a,{message:"Chargement des donn\xe9es",type:"info"}):S?o.a.createElement(I.a,{message:"Erreur lors du chargement des donn\xe9es::"+C,type:"error"}):o.a.createElement(G.a,{tag:"div",blocking:!1},o.a.createElement(T.a,{theme:Object(z.a)()},o.a.createElement(l.a,{title:ce,data:P["hydra:member"],columns:je,options:Object(r.a)(Object(r.a)({},u.a),{},{serverSide:!0,count:P["hydra:totalItems"],rowsPerPageOptions:[20,30,50],rowsPerPage:a.rowsPerPage,onChangePage:e=>(e=>{s(Object(r.a)(Object(r.a)({},a),{},{page:e})),c.invalidateQueries("Demandedecaisses")})(e),onChangeRowsPerPage:e=>(e=>{s(Object(r.a)(Object(r.a)({},a),{},{rowsPerPage:e})),console.log("idbre de ligne par page:"+e),c.invalidateQueries("Demandedecaisses")})(e),onSearchChange:e=>(e=>{var t;s(Object(r.a)(Object(r.a)({},a),{},{recherche:null!==e&&void 0!==e?e:""})),console.log(null!==(t="texte a chercher"+e)&&void 0!==t?t:""),c.invalidateQueries("Demandedecaisses")})(e),onFilterChange:()=>{console.log("le filtre a chang\xe9")}})}))),o.a.createElement(g.a,{className:"w-full overflow-auto",elevation:8},o.a.createElement(Y.a,{open:me,onConfirmDialogClose:()=>{pe(!1)},onYesClick:()=>{pe(!1),M.mutate(F)},text:"Confirmez la suppression de "+(null===F||void 0===F?void 0:F.name)})))):o.a.createElement(U,{action:J.action,ledemandedecaisse:F,handleFermeture:()=>{Z({mode:"affichage",action:"nouveau",affichageTable:!0}),le("Demandes \xe0 approuver")}}))}}}]);